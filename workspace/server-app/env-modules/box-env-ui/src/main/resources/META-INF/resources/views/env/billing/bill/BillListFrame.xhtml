<ui:composition template="/views/env/filter/ListFrame.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:o="http://omnifaces.org/ui"
                xmlns:p="http://primefaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
                xmlns:boxenv="http://argustelecom.ru/box/env">

    <ui:define name="completeFilterFields">
        <ul>
            <li>
                <div class="filter-item">
                    <span class="filter-name">
                        <p:outputLabel for="number" value="#{overallBundle['box.overall.number']}:"/>
                     </span>
                    <span class="filter-value">
                        <p:inputText id="number" value="#{billListViewState.number}"/>
                    </span>
                </div>
            </li>

            <li>
                <h:panelGroup id="panel_grouping">
                    <div class="filter-item">
                        <span class="filter-name">
                            <p:outputLabel for="bill_type" value="#{billBundle['box.bill.type']}:"/>
                        </span>
                        <span class="filter-value">
                            <p:selectOneMenu id="bill_type" value="#{billListViewState.billType}">
                                <p:ajax process="@this" update="#{filterFormId}-panel_grouping"/>
                                <f:selectItem itemValue=""/>
                                <f:selectItems value="#{billListVm.billTypes}" var="billType"
                                               itemLabel="#{billType.name}" itemValue="#{billType}"/>
                            </p:selectOneMenu>
                        </span>
                    </div>

                    <ui:fragment rendered="#{billListViewState.billType ne null}">
                        <div class="filter-item">
                            <span class="filter-name">
                                <p:outputLabel for="period" value="#{billBundle['box.bill.period.type']}:" styleClass="width-110"/>
                            </span>
                            <span class="filter-value">
                                <boxenv:inputPeriod id="period" value="#{billListViewState.period}" styleClass="period filter-period"
                                                    periodUnit="#{billListViewState.periodUnit}"/>
					        </span>
                        </div>
                    </ui:fragment>
                </h:panelGroup>
            </li>

            <li>
                <div class="filter-item">
                    <span class="filter-name">
                        <p:outputLabel for="bill_date" styleClass="width-130" value="#{billBundle['box.bill.date']}:"/>
                    </span>
                    <span class="filter-value">
                        <p:calendar id="bill_date" value="#{billListViewState.billDate}" locale="#{languageBean.locale.language}"
                                    pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}" styleClass="m-disp-block"/>
                    </span>
                </div>
            </li>

            <li>
                <div class="filter-item">
                    <span class="filter-name">
                        <p:outputLabel for="customer_type" value="#{billBundle['box.bill.customer.type']}:"/>
                    </span>
                    <span class="filter-value">
                        <p:selectOneMenu id="customer_type" value="#{billListViewState.customerType}">

                            <p:ajax process="@this" update="#{filterFormId}-customer"/>
                            <f:selectItem itemValue=""/>
                            <f:selectItems value="#{billListVm.customerTypes}" var="customerType"
                                           itemLabel="#{customerType.name}" itemValue="#{customerType}"/>
                        </p:selectOneMenu>
                    </span>
                </div>
                <p:outputPanel styleClass="width-100-percents">
                    <div class="filter-item">
                        <span class="filter-name">
                            <p:outputLabel for="customer" value="#{billBundle['box.bill.customer']}:"/>
                        </span>
                        <span class="filter-value">
                            <p:autoComplete id="customer" value="#{billListViewState.customer}" var="customer"
                                            itemValue="#{customer}" itemLabel="#{customer.name}"
                                            disabled="#{billListViewState.customerType eq null}"
                                            completeMethod="#{billListVm.completeCustomer}"/>
                        </span>
                    </div>
                </p:outputPanel>
            </li>

            <li>
                <div class="filter-item">
                    <span class="filter-name">
                           <p:outputLabel for="provider" value="#{billBundle['box.bill.provider']}:" rendered="#{billListVm.providerFilterRendered()}"/>
                    </span>
                    <span class="filter-value">
                            <p:selectOneMenu id="provider" value="#{billListViewState.provider}" rendered="#{billListVm.providerFilterRendered()}">
                                <f:selectItem itemValue=""/>
                                <f:selectItems value="#{billListVm.providers}" var="provider" itemLabel="#{provider.name}" itemValue="#{provider}"/>
                            </p:selectOneMenu>
                    </span>
                </div>
            </li>

            <li>
                <div class="filter-item">
                    <span class="filter-name">
                           <p:outputLabel for="broker" value="#{billBundle['box.bill.broker']}:" rendered="#{billListVm.brokerFilterRendered()}"/>
                    </span>
                    <span class="filter-value">
                        <p:selectOneMenu id="broker" value="#{billListViewState.broker}" rendered="#{billListVm.brokerFilterRendered()}">
                            <f:selectItem itemValue=""/>
                            <f:selectItems value="#{billListVm.brokers}" var="broker" itemLabel="#{broker.name}" itemValue="#{broker}"/>
                        </p:selectOneMenu>
                    </span>
                </div>
            </li>

        </ul>
    </ui:define>

    <ui:define name="shortFilterFields">
        <ul>
            <ui:fragment rendered="#{billListViewState.number ne null}">
                <li>
                    <p:outputLabel value="#{overallBundle['box.overall.number']}:"/>
                    <h:outputText value="#{billListViewState.number};"/>
                </li>
            </ui:fragment>

            <ui:fragment rendered="#{billListViewState.customerType.name ne null}">
                <li>
                    <p:outputLabel value="#{billBundle['box.bill.customer.type']}:"/>
                    <h:outputText value="#{billListViewState.customerType.name};"/>
                </li>
            </ui:fragment>

            <ui:fragment rendered="#{billListViewState.customer.name ne null}">
                <li>
                    <p:outputLabel value="#{billBundle['box.bill.customer']}:"/>
                    <h:outputText value="#{billListViewState.customer.name};"/>
                </li>
            </ui:fragment>

            <ui:fragment rendered="#{billListViewState.billDate ne null}">
                <li>
                    <p:outputLabel value="#{billBundle['box.bill.date']}:"/>
                    <h:outputText value="#{dateUtils.format(billListViewState.billDate, dateUtils.DATE_DEFAULT_PATTERN, TZ.serverTimeZone)}"/>
                </li>
            </ui:fragment>

            <ui:fragment rendered="#{billListViewState.billType.name ne null}">
                <li>
                    <p:outputLabel value="#{billBundle['box.bill.type']}:"/>
                    <h:outputText value="#{billListViewState.billType.name}"/>
                </li>
            </ui:fragment>

            <ui:fragment rendered="#{billListViewState.period ne null}">
                <li>
                    <p:outputLabel value="#{billBundle['box.bill.period.type']}:"/>
                    <h:outputText value="#{billListViewState.period.toString()}"/>
                </li>
            </ui:fragment>
        </ul>
    </ui:define>

    <ui:define name="searchResult">
        <h:form id="#{resultFormId}">

            <div class="ui-dashboard-header">
                <i class="fa fa-binoculars"/>
                <h:outputText styleClass="card-header" value="#{overallBundle['box.overall.searching_results']}"/>

                <o:importConstants type="ru.argustelecom.box.env.billing.bill.BillParamsDto.BillContext" var="contextType"/>
                <p:outputPanel styleClass="m-fright">
                    <p:commandButton id="send_bills_button" value="#{billBundle['box.bill.send']}" oncomplete="PF('billMassSendDlgVar').show()" update="bill_mass_send_form"/>
                    <p:commandButton id="recalc_bills_button" value="#{billBundle['box.bill.plural.recalculate']}" styleClass="m-mar-left-8"
                                     action="#{billMassRecalcDm.openMassRecalcDlg('bills_wizard_recalc_form', 'bills_recalc_dlg', 'billsRecalcDlgVar')}" process="@this">
                        <f:setPropertyActionListener value="#{contextType.MASS}" target="#{billMassRecalcDm.billParams.currentContext}"/>
                        <f:setPropertyActionListener value="false" target="#{billMassRecalcDm.billParams.templateRendered}"/>
                    </p:commandButton>
                    <p:commandButton id="create_bill_button" styleClass="m-mar-left-8" value="#{billBundle['box.bill.plural.create']}"/>
                    <p:overlayPanel id="create_bill_panel" widgetVar="createBillPanel" for="create_bill_button" styleClass="select-one-item-overlay-panel">
						<p:outputPanel styleClass="custom-split-button">
							<p:commandLink id="create_one_bill_button" styleClass="m-mar-left10 custom-split-button-item"
											value="#{billBundle['box.bill.create']}" process="@this"
											action="#{billCreationDm.openCreationDlg('bill_create_form', 'bill_create_dlg', 'billCreateDlgVar')}">
								<f:setPropertyActionListener value="#{contextType.LIST}" target="#{billCreationDm.billParams.currentContext}"/>
                        		<f:setPropertyActionListener value="#{billListVm.callbackAfterCreation}" target="#{billCreationDm.callbackAfterCreation}"/>
							</p:commandLink>

							<p:commandLink id="create_bills_button" styleClass="m-mar-left10 custom-split-button-item"
											value="#{billBundle['box.bill.plural.create.mass']}" process="@this"
											action="#{billCreationDm.openCreationDlg('bills_wizard_create_form', 'bills_create_dlg', 'billsCreateDlgVar')}">
								<f:setPropertyActionListener value="#{contextType.MASS}" target="#{billCreationDm.billParams.currentContext}"/>
							</p:commandLink>
						</p:outputPanel>
					</p:overlayPanel>
                </p:outputPanel>

            </div>

            <o:importConstants type="ru.argustelecom.box.env.billing.bill.BillLazyDataModel.BillSort"/>
            <o:importConstants type="org.primefaces.model.SortOrder"/>

            <p:dataTable id="bill_table" value="#{lazyDm}" var="bill" tableStyle="table-layout: fixed;"
                         lazy="true" paginator="true" rows="25" emptyMessage="#{overallBundle['box.overall.empty']}"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}" rowsPerPageTemplate="25,50,100" sortMode="single"
                         sortBy="#{BillSort.id}" sortOrder="descending" selectionMode="single">

                <p:column headerText="#{overallBundle['box.overall.id']}" sortBy="#{BillSort.id}" >
                    <boxenv:linkToCard value="#{bill.getIdentifiable()}" text="#{bill.id}"/>
                </p:column>

                <p:column headerText="#{overallBundle['box.overall.number']}" sortBy="#{BillSort.number}">
                    <h:outputText value="#{bill.number}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.date']}" sortBy="#{BillSort.billDate}">
                    <h:outputText value="#{bill.billDate}">
                        <sysinf:convertDateTime pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.summary']}" sortBy="#{BillSort.totalAmount}">
                    <boxenv:money value="#{bill.totalAmount}" size="fs14" unicolour="true"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.type']}" sortBy="#{BillSort.billType}">
                    <h:outputText value="#{bill.type.name}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.group']}" >
                    <boxenv:linkToCard id="groupingMethod" value="#{bill.group}" styleClass="m-mar-left-8"
                                       text="#{bill.groupingMethod.name} #{bill.groupId}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.provider']}" sortBy="#{BillSort.provider}" rendered="#{billListVm.providerFilterRendered()}">
                    <h:outputText value="#{bill.provider.name}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.broker']}" sortBy="#{BillSort.broker}" rendered="#{billListVm.brokerFilterRendered()}">
                    <h:outputText value="#{bill.broker.name}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.customer']}" sortBy="#{BillSort.customer}">
                    <h:outputText value="#{bill.customer.name}"/>
                </p:column>

                <p:column headerText="#{billBundle['box.bill.period']}">
                    <h:outputText value="#{bill.period.toString()}"/>
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>

</ui:composition>