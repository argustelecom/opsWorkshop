<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
				xmlns:sysinf="http://argustelecom.ru/system-inf" xmlns:pm="http://primefaces.org/modena"
				xmlns:f="http://java.sun.com/jsf/core" xmlns:boxenv="http://argustelecom.ru/box/env">

	<f:loadBundle var="transactionBundle" basename="TransactionBundle"/>
	<p:outputPanel rendered="#{p:ifGranted('Billing_TransactionView')}">
		<div class="m-container100 m-responsive100">
			<div class="m-container-indent">
				<div class="m-card m-shadow-effect m-hei-auto-on-mobile simple-fb">
					<h:form id="transaction_list_form">
						<f:event listener="#{transactionFrameModel.preRender(personalAccount, frameHeight)}" type="preRenderComponent" />

						<div class="ui-dashboard-header">
							<i class="fa fa-tasks" />
							<h:outputText value="#{transactionBundle['box.transaction.plural']}" styleClass="card-header"/>

							<p:outputPanel id="property_managed_buttons" styleClass="m-fright">
								<p:commandLink styleClass="m-mar-left10" oncomplete="PF('transactionCreationVar').show()"
							                 	title="#{overallBundle['box.overall.create']}" process="@this" update="transaction_creation_form"
							                 	disabled="#{!p:ifGranted('Billing_TransactionCreate')}">
												<i class="fa fa-edit icon-btn"/>
												<f:setPropertyActionListener value="#{transactionFrameModel.personalAccount}" target="#{transactionCreationDialogModel.personalAccount}"/>
												<f:setPropertyActionListener value="#{transactionFrameModel.getTransactionCreationCallback()}" target="#{transactionCreationDialogModel.transactionCreationCallback}"/>
								</p:commandLink>
							</p:outputPanel>
						</div>

						<div class="m-container100">
							<div class="m-container100">
								<h:inputText styleClass="visibility-hidden width-0"/>
								<p:outputLabel for="left_bound"
											   value="#{transactionBundle['box.transaction.from']}: "/>
								<p:calendar id="left_bound" value="#{transactionFilterState.startDate}" pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"
											styleClass="m-mar-right20" locale="#{languageBean.locale.language}"/>
								<p:outputLabel for="right_bound"
											   value=" #{transactionBundle['box.transaction.to']} "
											   styleClass="m-mar-right10"/>
								<p:calendar id="right_bound" value="#{transactionFilterState.endDate}" pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"
											styleClass="m-mar-right30" locale="#{languageBean.locale.language}"/>

								<p:commandLink id="filter_transactions" title="#{overallBundle['box.overall.search']}"
											   action="#{transactionFrameModel.applyFilter()}" update="transaction_table transaction_list_form-clear_filter_transactions">
												<i class="fa fa-filter icon-btn"/>
								</p:commandLink>
								<p:commandLink id="clear_filter_transactions" title="#{overallBundle['box.overall.clear']}"
											   disabled="#{not transactionFrameModel.filtered}"
											   action="#{transactionFrameModel.clearFilters()}" update="transaction_list_form transaction_table">
									<i class="fa fa-eraser icon-btn"/>
								</p:commandLink>
							</div>

							<p:remoteCommand name="updateTransactionTableData" action="#{transactionFrameModel.lazyDM.reloadData}" update="transaction_table" autoRun="false"/>

							<div class="m-container100 m-mar-top10">
								<p:dataTable id="transaction_table" value="#{transactionFrameModel.lazyDM}" var="transaction"
											 lazy="true" paginator="true" rows="10" styleClass="paginator-top-hidden" emptyMessage="#{overallBundle['box.overall.empty']}"
											 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
											 currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}" rowsPerPageTemplate="10,25,50"
											 sortBy="#{TransactionSort.date}" sortOrder="descending">
									<p:column headerText="#{transactionBundle['box.transaction.created']}"
											  sortBy="#{TransactionSort.date}">
										#{dateUtils.format(transaction.transactionDate, dateUtils.DATETIME_DEFAULT_PATTERN, TZ.serverTimeZone)}
									</p:column>

									<p:column headerText="#{overallBundle['box.overall.id']}">
										#{transaction.id}
									</p:column>

									<p:column headerText="#{transactionBundle['box.transaction.reason.type']}">
										#{transaction.reasonType}
									</p:column>

									<p:column headerText="#{transactionBundle['box.transaction.reason.name']}">
										<boxenv:linkToCard value="#{transactionFrameModel.findInvoiceByReasonNumber(transaction.reasonType, transaction.reasonNumber)}" text="#{transaction.reasonNumber}"/>
									</p:column>

									<p:column headerText="#{transactionBundle['box.transaction.amount']}">
										<boxenv:money value="#{transaction.amount}" unicolour="true" size="fs14"/>
									</p:column>

								</p:dataTable>
							</div>
						</div>
					</h:form>
				</div>
			</div>
		</div>
	</p:outputPanel>

	<ui:include src="/views/env/page/frame/NotGrantedFrame.xhtml">
		<ui:param name="headerIcon" value="fa fa-tasks" />
		<ui:param name="headerText" value="#{personalAccountBundle['box.personal_account.transaction']}" />
		<ui:param name="permission" value="#{permissionRepository.getPermission('Billing_TransactionView')}" />
	</ui:include>

	<ui:include src="TransactionCreationDialog.xhtml">
		<ui:param name="update" value="-transaction_list_form-transaction_table personal_account_attributes_form"/>
	</ui:include>
</ui:composition>