<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:p="http://primefaces.org/ui" xmlns:boxenv="http://argustelecom.ru/box/env"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf">


	<f:loadBundle var="chargeJobBundle" basename="ChargeJobBundle"/>
	<f:loadBundle var="tariffBundle" basename="TariffBundle"/>
	<f:loadBundle var="serviceBundle" basename="ServiceBundle"/>

	<div class="m-container100 m-responsive100">
		<div class="message message-icon message-icon-info">
			<p>#{chargeJobBundle['box.charge_job.wizard.step.input_params.tip']}</p>
		</div>

		<dl class="name-value width-150 name-value-tooltip">
			<dt>
				<p:outputLabel for="date_from"
							   value="#{chargeJobBundle['box.charge_job.wizard.step.input_params.date_from']}:"/>
			</dt>
			<dd>
				<p:calendar id="date_from" value="#{chargeJobCreationDm.newJob.filter.dateFrom}" required="true"
							pattern="#{dateUtils.DATETIME_WITH_SECONDS_PATTERN}" styleClass="width-40-percents"
							locale="#{languageBean.locale.language}" label="#{chargeJobBundle['box.charge_job.wizard.step.input_params.date_from']}"
							validator="ru.argustelecom.box.inf.validator.type.DateRangeValidator">
					<p:ajax event="dateSelect" process="@this" update="date_to"/>
					<f:attribute name="maximum" value="#{chargeJobCreationDm.newJob.filter.dateTo}"/>
				</p:calendar>

				<p:outputLabel for="date_to"
							   value="#{chargeJobBundle['box.charge_job.wizard.step.input_params.date_to']}:"
							   styleClass="m-tex-al-right width-17-percents"/>
				<p:calendar id="date_to" value="#{chargeJobCreationDm.newJob.filter.dateTo}"
							pattern="#{dateUtils.DATETIME_WITH_SECONDS_PATTERN}"
							styleClass="width-40-percents" required="true" validator="ru.argustelecom.box.inf.validator.type.DateRangeValidator"
							mindate="#{chargeJobCreationDm.newJob.filter.dateFrom}"
							locale="#{languageBean.locale.language}" label="#{chargeJobBundle['box.charge_job.wizard.step.input_params.date_to']}">
					<f:attribute name="minimum" value="#{chargeJobCreationDm.newJob.filter.dateFrom}"/>
				</p:calendar>
			</dd>
		</dl>

		<o:importConstants
				type="ru.argustelecom.box.env.billing.invoice.chargejob.ChargeJobCreationDialogModel.RechargeCause"/>

		<ui:fragment rendered="#{chargeJobCreationDm.newJob.cause.equals(RechargeCause.SELECT_WRONG_TARIFF)
			or chargeJobCreationDm.newJob.cause.equals(RechargeCause.ERRORS_IN_TARIFF)
			or chargeJobCreationDm.newJob.cause.equals(RechargeCause.ERROR_IN_SERVICE_RESOURCE_RELATIONSHIP)}">

			<!-- Метод сделан умышленно. validateOneOrMore не может получить сообщение из
			#{chargeJobBundle['box.charge_job.wizard.step.input_params.validation.msg']}, поэтому получение сообщения
			вынесено в метод -->
			<o:validateOneOrMore components="new_service new_tariff new_customer"
								 message="#{chargeJobCreationDm.getValidationMessageForInputParamsStep()}"/>

			<dl class="name-value width-150 name-value-tooltip">
				<dt>
					<p:outputLabel for="new_customer_type"
								   value="#{tariffBundle['box.telephony.tariff.customer.type']}:"/>
				</dt>
				<dd>
					<p:selectOneMenu id="new_customer_type" styleClass="width-40-percents"
									 value="#{chargeJobCreationDm.newJob.customerType}"
									 label="#{tariffBundle['box.telephony.tariff.customer.type']}">

						<p:ajax process="@this" update="new_customer new_service new_service_type"/>

						<f:selectItem itemValue="#{null}"/>
						<f:selectItems value="#{chargeJobCreationDm.possibleCustomerTypes}" var="customerType"
									   itemLabel="#{customerType.name}" itemValue="#{customerType}"/>
					</p:selectOneMenu>

					<p:outputLabel for="new_customer" styleClass="m-tex-al-right width-17-percents"
								   value="#{tariffBundle['box.telephony.tariff.customer']}:"/>
					<p:autoComplete id="new_customer" value="#{chargeJobCreationDm.newJob.customer}" var="customer"
									itemValue="#{customer}" itemLabel="#{customer.objectName}"
									styleClass="width-40-percents"
									required="#{chargeJobCreationDm.newJob.customerType ne null}" inputStyle="position:relative;bottom:10px"
									disabled="#{chargeJobCreationDm.newJob.customerType eq null}"
									completeMethod="#{chargeJobCreationDm.completeCustomer}"
									label="#{tariffBundle['box.telephony.tariff.customer']}">
						<p:ajax event="itemSelect" update="new_service new_service_type"/>
					</p:autoComplete>
				</dd>
			</dl>

			<dl class="name-value width-150 name-value-tooltip m-pad-top20">
				<dt>
					<p:outputLabel for="new_service_type" value="#{serviceBundle['box.service.type']}:"/>
				</dt>
				<dd>
					<p:selectOneMenu id="new_service_type"
									 value="#{chargeJobCreationDm.newJob.serviceType}"
									 label="#{serviceBundle['box.service.type']}"
									 styleClass="width-40-percents">

						<p:ajax process="@this" update="new_service"/>

						<f:selectItem itemValue="#{null}"/>
						<f:selectItems value="#{chargeJobCreationDm.getPossibleServiceTypes()}" var="serviceType"
									   itemLabel="#{serviceType.name}" itemValue="#{serviceType}"/>
					</p:selectOneMenu>

					<p:outputLabel for="new_service" value="#{serviceBundle['box.service']}:"
								   styleClass="m-tex-al-right width-17-percents"/>
					<p:selectOneMenu id="new_service" styleClass="width-40-percents" filter="true" filterMatchMode="contains"
									 value="#{chargeJobCreationDm.newJob.service}"
									 label="#{serviceBundle['box.service']}" var="service"
									 required="#{chargeJobCreationDm.newJob.serviceType ne null}"
									 disabled="#{chargeJobCreationDm.newJob.serviceType eq null}">

						<f:selectItem itemValue="#{null}"/>
						<f:selectItems value="#{chargeJobCreationDm.possibleServices}" var="possibleService"
									   itemLabel="#{possibleService.name} #{possibleService.id} #{possibleService.contract.objectName}" itemValue="#{service}"/>

						<p:column>
							<h:outputText styleClass="ui-theme ui-theme-#{service.name}" />
						</p:column>

						<p:column>
							<h:outputText value="#{service.name}" />
						</p:column>

						<p:column>
							<h:outputText value="#{service.id}" />
						</p:column>

						<p:column>
							<h:outputText value="#{service.contract.objectName}" />
						</p:column>
					</p:selectOneMenu>
				</dd>
			</dl>

			<dl class="name-value width-450 name-value-tooltip">
				<dt>
					<p:outputLabel for="new_tariff"
								   value="#{chargeJobBundle['box.charge_job.wizard.step.input_params.tariff']}:"/>
				</dt>
				<dd>
					<p:selectOneMenu id="new_tariff" styleClass="width-96-percents"
									 value="#{chargeJobCreationDm.newJob.tariff}"
									 label="#{chargeJobBundle['box.charge_job.wizard.step.input_params.tariff']}">

						<f:selectItem itemValue="#{null}"/>
						<f:selectItems value="#{chargeJobCreationDm.possibleTariffs}" var="tariff"
									   itemLabel="#{tariff.name}" itemValue="#{tariff}"/>
					</p:selectOneMenu>
				</dd>
			</dl>
		</ui:fragment>

		<h:panelGroup id="input_params_nav_block" layout="block" styleClass="dialog-footer-buttons">
			<p:commandButton value="#{overallBundle['box.overall.back']}" oncomplete="PF('chargeJobWizardVar').back()"
							 process="@this"/>

			<p:commandButton value="#{overallBundle['box.overall.next']}" oncomplete="PF('chargeJobWizardVar').next()"
							 process="@this" style="margin-right: 14px;"/>
		</h:panelGroup>
	</div>
</ui:composition>
