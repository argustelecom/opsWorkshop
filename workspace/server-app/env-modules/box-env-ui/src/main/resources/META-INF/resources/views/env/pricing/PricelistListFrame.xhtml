<ui:composition template="/views/env/filter/ListFrame.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:boxenv="http://argustelecom.ru/box/env">

	<f:loadBundle var="pricelistBundle" basename="PricelistBundle"/>
    <ui:define name="completeFilterFields">
        <ul>
            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="search_query" value="#{overallBundle['box.overall.name']}:"/>
					</span>
					<span class="filter-value">
						<p:inputText id="search_query" value="#{pricelistJournalViewState.name}"
									 process="@this" maxlength="128"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="valid_from" value="#{overallBundle['box.overall.valid_from']}:"/>
					</span>
					<span class="filter-value">
						<p:calendar id="valid_from" value="#{pricelistJournalViewState.validFrom}"
									pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}" process="@this"
									styleClass="width-43-percents" locale="#{languageBean.locale.language}"/>

						<p:outputLabel for="valid_to" styleClass="m-tex-al-right width-10-percents mar-top-2" value="#{overallBundle['box.overall.valid_to.short']}:"/>
						<p:calendar id="valid_to" value="#{pricelistJournalViewState.validTo}"
									styleClass="width-43-percents" pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}"
									process="@this" locale="#{languageBean.locale.language}"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="status" value="#{overallBundle['box.overall.state']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="status" value="#{pricelistJournalViewState.state}" process="@this">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{pricelistJournalViewModel.states}"
										   var="pricelistStatus" itemLabel="#{pricelistStatus.name}"
										   itemValue="#{pricelistStatus}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

            <ui:fragment rendered="#{pricelistJournalViewModel.renderOwner}">
                <li>
                    <div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="owners" value="#{overallBundle['box.overall.owner']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="owners" value="#{pricelistJournalViewState.owner}" process="@this">
                            <f:selectItem itemValue=""/>
                            <f:selectItems value="#{pricelistJournalViewModel.owners}"
                                           var="owner" itemLabel="#{owner.name}"
                                           itemValue="#{owner}"/>
                        </p:selectOneMenu>
					</span>
                    </div>
                </li>
            </ui:fragment>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="mode" styleClass="width-120" value="#{overallBundle['box.overall.type']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="mode" value="#{pricelistJournalViewState.mode}" process="@this" styleClass="pricelist-search-type">

							<p:ajax process="@this" update="#{filterFormId} #{resultFormId}"/>

							<f:selectItems value="#{pricelistJournalViewState.modes}"
										   var="mode" itemLabel="#{mode.name}" itemValue="#{mode}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

            <ui:fragment rendered="#{pricelistJournalViewState.mode eq 'COMMON'}">
                <li>
					<div class="filter-item">
						<span class="filter-name">
							<p:outputLabel value="#{pricelistBundle['box.pricelist.segment']}:"/>
						</span>
						<span class="filter-value">
							<p:selectOneMenu value="#{pricelistJournalViewState.segment}">
								<f:selectItem itemValue=""/>
								<f:selectItems value="#{pricelistJournalViewModel.segments}" var="segment"
											   itemLabel="#{segment.name}" itemValue="#{segment}"/>
							</p:selectOneMenu>
						</span>
					</div>
				</li>
            </ui:fragment>

            <ui:fragment rendered="#{pricelistJournalViewState.mode eq 'CUSTOM'}">
                <li>
					<div class="filter-item">
						<span class="filter-name">
							<p:outputLabel for="customer_type" value="#{pricelistBundle['box.pricelist.customer.type']}:"/>
						</span>
						<span class="filter-value">
							<p:selectOneMenu id="customer_type" value="#{pricelistJournalViewState.customerType}">

								<p:ajax process="@this" update="#{filterFormId}-customer"/>

								<f:selectItem itemValue=""/>
								<f:selectItems value="#{pricelistJournalViewModel.customerTypes}" var="customerType"
											   itemLabel="#{customerType.name}" itemValue="#{customerType}"/>
							</p:selectOneMenu>
						</span>
					</div>
				</li>

                <li>
					<div class="filter-item">
						<span class="filter-name">
							<p:outputLabel for="customer" value="#{pricelistBundle['box.pricelist.customer']}:"/>
						</span>
						<span class="filter-value">
							<p:autoComplete id="customer" value="#{pricelistJournalViewState.customer}" var="customer"
											itemValue="#{customer}" itemLabel="#{customer.name}"
											disabled="#{pricelistJournalViewState.customerType eq null}"
											completeMethod="#{pricelistJournalViewModel.completeCustomer}"/>
						</span>
					</div>
				</li>
            </ui:fragment>
        </ul>
    </ui:define>

    <ui:define name="shortFilterFields">
        <ul>
			<ui:fragment rendered="#{pricelistJournalViewState.name ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.name']}:"/>
					<h:outputText value="#{pricelistJournalViewState.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.validFrom ne null or pricelistJournalViewState.validTo ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.valid_from']}:"/>
					<h:outputText value="#{dateUtils.format(pricelistJournalViewState.validFrom, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)}"/>
					<p:outputLabel value="#{overallBundle['box.overall.valid_to.short']}" styleClass="m-pad-left-3" rendered="#{pricelistJournalViewState.validTo ne null}"/>
					<h:outputText value="#{dateUtils.format(pricelistJournalViewState.validTo, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.owner.name ne null}">
				<li>
					<p:outputLabel value="#{pricelistBundle['box.pricelist.owner']}:"/>
					<h:outputText value="#{pricelistJournalViewState.owner.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.segment.name ne null}">
                <li>
                    <p:outputLabel value="#{pricelistBundle['box.pricelist.segment']}:"/>
                    <h:outputText value="#{pricelistJournalViewState.segment.name};"/>
                </li>
            </ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.state.name ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.state']}:"/>
					<h:outputText value="#{pricelistJournalViewState.state.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.mode.name ne null}">
				<li>
					<p:outputLabel value="#{pricelistBundle['box.pricelist.type']}:"/>
					<h:outputText value="#{pricelistJournalViewState.mode.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{pricelistJournalViewState.mode eq 'CUSTOM'}">
				<ui:fragment rendered="#{pricelistJournalViewState.customerType.name ne null}">
					<li>
						<p:outputLabel for="contract_short" value="#{pricelistBundle['box.pricelist.customer.type']}:"/>
						<h:outputText id="contract_short" value="#{pricelistJournalViewState.customerType.name};"/>
					</li>
				</ui:fragment>

				<ui:fragment rendered="#{pricelistJournalViewState.customer.name ne null}">
					<li>
						<p:outputLabel for="personal_account_short" value="#{pricelistBundle['box.pricelist.customer']}:"/>
						<h:outputText id="personal_account_short" value="#{pricelistJournalViewState.customer.name};"/>
					</li>
				</ui:fragment>
			</ui:fragment>
        </ul>
    </ui:define>

	<ui:define name="searchResult">
		<h:form id="#{resultFormId}">

			<div class="ui-dashboard-header">
				<i class="fa fa-binoculars"/>
				<h:outputText styleClass="card-header" value="#{overallBundle['box.overall.searching_results']}"/>

				<p:outputPanel styleClass="m-fright">
					<p:commandButton id="create_pricelist_button" value="#{pricelistBundle['box.pricelist.create']}"
									 disabled="#{p:ifNoneGranted('ProductManagment_CommonPriceListEdit,ProductManagment_CustomPriceListEdit')}"
									 update="pricelist_creation_modes"/>

					<p:overlayPanel id="pricelist_creation_panel" widgetVar="pricelistCreationPanelVar" for="create_pricelist_button"
									styleClass="select-one-item-overlay-panel">
						<p:selectOneListbox id="pricelist_creation_modes" value="#{pricelistCreationDialogModel.mode}">

							<p:ajax process="@this" listener="#{pricelistCreationDialogModel.onCreationDialogOpen()}"/>

							<f:selectItems value="#{pricelistCreationDialogModel.modesForCreationButton}" var="mode"
										   itemValue="#{mode}" itemLabel="#{mode.name}" itemDisabled="#{!p:ifGranted(mode.permissionId)}"/>
						</p:selectOneListbox>
					</p:overlayPanel>
				</p:outputPanel>

			</div>

			<p:dataTable id="personnel_table" value="#{pricelistJournalViewModel.lazyDm}" var="pricelist" lazy="true"
						 paginator="true" rows="25" emptyMessage="#{overallBundle['box.overall.empty']}"
						 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						 currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}" rowsPerPageTemplate="25,50,100" sortMode="single"
						 sortBy="#{PricelistSort.id}" sortOrder="descending" selectionMode="single">

				<p:column headerText="#{overallBundle['box.overall.id']}" sortBy="#{PricelistSort.id}">
					<boxenv:linkToCard value="#{pricelist.getIdentifiable()}" text="#{pricelist.id}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.name']}" sortBy="#{PricelistSort.name}">
					<h:outputText value="#{pricelist.name}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.state']}" sortBy="#{PricelistSort.state}">
					<h:outputText value="#{pricelist.state}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.valid_from']}" sortBy="#{PricelistSort.validFrom}">
					<h:outputText value="#{dateUtils.format(pricelist.validFrom, dateUtils.DATE_DEFAULT_PATTERN, TZ.serverTimeZone)}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.valid_to']}" sortBy="#{PricelistSort.validTo}">
					<h:outputText value="#{dateUtils.format(pricelist.validTo, dateUtils.DATE_DEFAULT_PATTERN, TZ.serverTimeZone)}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.owner']}" sortBy="#{PricelistSort.owner}" rendered="#{pricelistJournalViewModel.renderOwner}">
					<h:outputText value="#{pricelist.owner.name}"/>
				</p:column>

				<p:column headerText="#{pricelistBundle['box.pricelist.segment']}" rendered="#{pricelistJournalViewModel.showCommonColumns()}">
					<ui:fragment rendered="#{pricelist.segmentNames ne null}">
						<ui:repeat value="#{pricelist.segmentNames}" var="segment">
							<h:outputText value="#{segment}"/><br/>
						</ui:repeat>
					</ui:fragment>
				</p:column>

				<p:column headerText="#{pricelistBundle['box.pricelist.customer.type']}"
						  rendered="#{pricelistJournalViewModel.showCustomColumns()}" sortBy="#{PricelistSort.client}">
					<ui:fragment rendered="#{pricelist.customerDto ne null}">
						<boxenv:linkToCard value="#{pricelist.customerDto.getIdentifiable()}" text="#{pricelist.customerDto.name}"/>
					</ui:fragment>
				</p:column>

			</p:dataTable>
		</h:form>
	</ui:define>

</ui:composition>