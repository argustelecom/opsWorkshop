<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
	xmlns:sysinf="http://argustelecom.ru/system-inf" xmlns:pm="http://primefaces.org/modena">

	<ui:param name="viewModel" value="#{documentTypeDirectoryVm}" />
	<ui:param name="pageTitle" value="#{documentTypeBundle['box.doc.type.plural']}" />

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="documentType" value="#{documentTypeDirectoryVs.documentTypeUnit}" required="false"
				converter="documentTypeUnitConverter" />
		</f:metadata>
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet name="box-env/styles/box-env.css" />
		<h:outputStylesheet name="inf/styles/box-functional-block.css" />
	</ui:define>

	<ui:define name="pagePath">
		<f:loadBundle basename="OverallBundle" var="overallBundle" />
		<f:loadBundle basename="DocumentTypeBundle" var="documentTypeBundle" />
		<f:loadBundle basename="TypeBundle" var="typeBundle" />

		<p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml" />
		<p:menuitem value="#{overallBundle['box.overall.dir.dashboard']}" url="/views/env/directory/DirectoryDashboardView.xhtml" />
		<p:menuitem value="#{documentTypeBundle['box.doc.type.plural']}" />
	</ui:define>

	<ui:define name="body">
		<div class="m-container35 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<h:form id="document_type_tree_form">

							<o:importConstants type="ru.argustelecom.box.env.document.type.DocumentTypeCategory" var="category" />
							<o:importConstants type="ru.argustelecom.box.env.document.type.DocumentTypeDirectoryViewModel" />

							<div class="ui-dashboard-header">
								<p:inputText styleClass="m-wid50 m-wid-auto-on-mobile m-mar-right10" disabled="true"/>
								<i class="fa fa-search"></i>

								<p:outputPanel id="document_type_controls" styleClass="m-tex-al-right m-fright">
									<p:commandLink  id="create_document_type_button" styleClass="m-mar-left10"
											title="#{overallBundle['box.overall.add']}"
											update="doctype_attributes_form doctype_templates_form type_property_form"
											disabled="#{!p:ifGranted('System_DocumentTypesEdit')}">
											<i class="fa fa-edit icon-btn"/>
									</p:commandLink>

									<p:overlayPanel id="document_type_categories_panel" widgetVar="documentTypeCategoriesPanelVar"
													for="create_document_type_button" styleClass="select-one-item-overlay-panel">
										<ul class="directory-creation-list">
											<li>
												<p:commandLink id="contract_type_creation_dlg"
																 action="#{documentTypeCreationDm.onCreationDialogOpen('documentTypeCategoriesPanelVar', 'document_type_creation_form', 'documentTypeCreationDlgVar')}"
																 value="#{category.CONTRACT_TYPE.name}">
													<f:setPropertyActionListener value="#{category.CONTRACT_TYPE}"
																				 target="#{documentTypeCreationDm.newDocTypeCategory}"/>
													<f:setPropertyActionListener value="#{documentTypeDirectoryVm.documentTypeCallback}"
																				 target="#{documentTypeCreationDm.documentTypeCallback}"/>
												</p:commandLink>
											</li>
											<li>
												<p:commandLink id="contract_extension_type_dlg"
																 action="#{documentTypeCreationDm.onCreationDialogOpen('documentTypeCategoriesPanelVar', 'document_type_creation_form', 'documentTypeCreationDlgVar')}"
																 value="#{category.CONTRACT_EXTENSION_TYPE.name}">
													<f:setPropertyActionListener value="#{category.CONTRACT_EXTENSION_TYPE}"
																				 target="#{documentTypeCreationDm.newDocTypeCategory}"/>
													<f:setPropertyActionListener value="#{documentTypeDirectoryVm.documentTypeCallback}"
																				 target="#{documentTypeCreationDm.documentTypeCallback}"/>
												</p:commandLink>
											</li>
											<li>
												<p:commandLink id="bill_type_dlg"
																 action="#{documentTypeCreationDm.onCreationDialogOpen('documentTypeCategoriesPanelVar', 'bill_type_create_form', 'billTypeCreationDlgVar')}"
																 value="#{category.BILL_TYPE.name}">
													<f:setPropertyActionListener value="#{category.BILL_TYPE}"
																				 target="#{documentTypeCreationDm.newDocTypeCategory}"/>
													<f:setPropertyActionListener value="#{documentTypeDirectoryVm.documentTypeCallback}"
																				 target="#{billTypeCreateDm.documentTypeCallback}"/>
												</p:commandLink>
											</li>
										</ul>
									</p:overlayPanel>

									<p:commandLink  styleClass="m-mar-left10" action="#{documentTypeDirectoryVm.removeCurrentDocumentType()}"
											title="#{overallBundle['box.overall.delete']}"
											process="@this" disabled="#{!p:ifGranted('System_DocumentTypesEdit') or not documentTypeDirectoryVm.canRemoveCurrentDocumentType()}"
											update="document_type_tree_form doctype_attributes_form doctype_templates_form type_property_form down_container_id">
										<i class="fa fa-trash icon-btn"/>
										<p:confirm header="#{documentTypeBundle['box.doc.type.delete_dialog']}"
											   message="#{documentTypeBundle['box.doc.type.delete_dialog.details']} '#{documentTypeDirectoryVm.currentDocumentTypeDto.name}'" />
									</p:commandLink>
								</p:outputPanel>
							</div>

							<p:outputPanel id="tree_panel" styleClass="fs14">
								<p:tree id="document_type_tree" styleClass="width-100-percents m-ov-auto tree-no-border"
									value="#{documentTypeDirectoryVm.documentTypeTree}" var="node" lazy="true" dynamic="true"
									selectionMode="single" selection="#{documentTypeDirectoryVm.selectedNode}" highlight="true"
									cashe="false" propagateSelectionUp="false" propagateSelectionDown="false">

									<p:ajax event="select"
										update="document_type_tree_form-document_type_controls doctype_attributes_form
										doctype_templates_form type_property_form down_container_id middle_container_id
										bill_analytic_param_form type_property_frame_id bill_analytic_type_frame_id" />
									<p:treeNode type="#{DocumentTypeDirectoryViewModel.CATEGORY_NODE_TYPE}">
										<i class="fa fa-folder-open m-fleft m-mar-right3 m-mar-top3" />
										<h:outputText value=" #{node.objectName}" />
									</p:treeNode>

									<p:treeNode type="#{category.CONTRACT_TYPE.keyword}">
										<i class="#{category.CONTRACT_TYPE.icon} m-fleft m-mar-right3 m-mar-top3"/>
										<h:outputText value=" #{node.objectName}" />
									</p:treeNode>

									<p:treeNode type="#{category.CONTRACT_EXTENSION_TYPE.keyword}">
										<i class="#{category.CONTRACT_EXTENSION_TYPE.icon} m-fleft m-mar-right3 m-mar-top3"/>
										<h:outputText value=" #{node.objectName}" />
									</p:treeNode>

									<p:treeNode type="#{category.BILL_TYPE.keyword}">
										<i class="#{category.BILL_TYPE.icon} m-fleft m-mar-right3 m-mar-top3"/>
										<h:outputText value=" #{node.objectName}" />
									</p:treeNode>
								</p:tree>
							</p:outputPanel>

							<script>
								$( document ).ready(function() {
									Argus.System.AutoHeight.compute('document_type_tree_form', 40);
									Argus.System.AutoHeight.compute('document_type_tree_form-document_type_tree', 50);
								});
							</script>

						</h:form>
					</div>
				</div>
			</div>
		</div>

		<!-- Информация по выбранному объекту -->
		<div class="m-container65 m-responsive100">

			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect">
						<h:form id="doctype_attributes_form">
							<p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank m-tex-al-center m-fleft width-300"
								rendered="#{documentTypeDirectoryVm.currentDocumentTypeDto eq null}">
								<i class="fa fa-question fs60"></i>
							</p:panelGrid>
							<ui:fragment rendered="#{documentTypeDirectoryVm.currentCategory eq category.CONTRACT_TYPE
													or documentTypeDirectoryVm.currentCategory eq category.CONTRACT_EXTENSION_TYPE}">
								<ui:include src="ContractTypeAttributesFrame.xhtml">
									<ui:param name="update" value="document_type_tree_form-document_type_tree doctype_attributes_form"/>
									<ui:param name="documentTypeDto" value="#{documentTypeDirectoryVm.currentDocumentTypeDto}"/>
									<ui:param name="readonly" value="#{!p:ifGranted('System_DocumentTypesEdit')}"/>
								</ui:include>
							</ui:fragment>

							<ui:fragment rendered="#{documentTypeDirectoryVm.currentCategory eq category.BILL_TYPE}">
								<ui:include src="BillTypeAttributesFrame.xhtml">
									<ui:param name="update" value="document_type_tree_form-document_type_tree doctype_attributes_form"/>
									<ui:param name="documentTypeDto" value="#{documentTypeDirectoryVm.currentDocumentTypeDto}"/>
									<ui:param name="readonly" value="#{!p:ifGranted('System_DocumentTypesEdit')}"/>
								</ui:include>
							</ui:fragment>
						</h:form>
					</div>
				</div>
			</div>

			<h:panelGroup id="middle_container_id">
				<div class="m-container100">
					<div class="m-container-indent">
						<div class="m-card m-shadow-effect simple-fb">
							<ui:include src="/views/env/report/ReportTemplatesFrame.xhtml">
								<ui:param name="templateHolder" value="#{documentTypeDirectoryVm.currentDocumentTypeDto.getIdentifiable()}" />
								<ui:param name="scrollable" value="true" />
								<ui:param name="scrollHeight" value="0" />
								<ui:param name="readonly" value="#{!p:ifGranted('System_DocumentTypePatternAdd')}" />
							</ui:include>
						</div>
					</div>
				</div>
			</h:panelGroup>

			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<h:panelGroup id="down_container_id">
							<ui:fragment id="type_property_frame_id"
										 rendered="#{documentTypeDirectoryVm.currentCategory eq category.CONTRACT_TYPE
										 or documentTypeDirectoryVm.currentCategory eq category.CONTRACT_EXTENSION_TYPE
										 or documentTypeDirectoryVm.currentCategory eq null}">
								<ui:include src="/views/env/type/TypePropertyFrame.xhtml">
									<ui:param name="readonly" value="#{!p:ifGranted('System_DocumentTypeTypeEdit')}"/>
									<ui:param name="type" value="#{currentType.value}"/>
								</ui:include>
							</ui:fragment>

							<ui:fragment id="bill_analytic_type_frame_id"
										 rendered="#{documentTypeDirectoryVm.currentCategory eq category.BILL_TYPE}">
								<ui:include src="BillAnalyticTypeFrame.xhtml" >
									<ui:param name="readonly" value="#{!p:ifGranted('System_DocumentTypeTypeEdit')}"/>
									<ui:param name="documentTypeDto" value="#{documentTypeDirectoryVm.currentDocumentTypeDto}"/>
								</ui:include>
							</ui:fragment>
						</h:panelGroup>
					</div>
				</div>
			</div>
		</div>

	</ui:define>

	<ui:define name="dialogs">
		<ui:include src="DocumentTypeCreationDialog.xhtml">
			<ui:param name="update"
				value="document_type_tree_form doctype_attributes_form doctype_templates_form type_property_form" />
		</ui:include>

		<ui:include src="BillTypeCreateDialog.xhtml">
			<ui:param name="update"
					  value="document_type_tree_form doctype_attributes_form doctype_templates_form type_property_form down_container_id" />
		</ui:include>

		<ui:include src="/views/env/report/ReportTemplatesEditDialog.xhtml">
			<ui:param name="update" value="doctype_templates_form" />
		</ui:include>

		<ui:include src="/views/env/type/TypePropertyAddDialog.xhtml"/>

		<ui:include src="/views/env/type/TypePropertyEditDialog.xhtml"/>

		<ui:include src="/views/env/type/TypePropertyGroupEditDialog.xhtml">
			<ui:param name="updatedElements" value="type_property_form"/>
		</ui:include>

		<ui:include src="BillAnalitycTypesEditDialog.xhtml">
			<ui:param name="update" value="document_type_tree_form-document_type_tree doctype_attributes_form down_container_id bill_analytic_param_form" />
		</ui:include>
	</ui:define>

</ui:composition>