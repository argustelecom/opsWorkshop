<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html">

	<f:event listener="#{lifecycleInfoFrameModel.preRender(lifecycle)}"
			 type="preRenderComponent"/>
	<style type="text/css">
		.ui-diagram-element {
			width:14em;
			height:4em;
			line-height:4em;
			text-align: center;
			box-shadow: 0 5px 10px rgba(0, 0, 0, 0.8);
			border-radius: 4px;
			border: 1px solid transparent;
			background-color: #98AFC7;
			color: #ffffff;
		}
	</style>

	<script type="text/javascript">
        //костыль для сохранения положения элемента на графе
        function node_onMouseOut(nodeElement) {
            var parent = nodeElement.parentElement;
            diagram_onNodeMove([
                {name: 'node_id', value: parent.id},
                {name: 'node_x', value: parent.style['left']},
                {name: 'node_y', value: parent.style['top']}
            ]);
        }
        //костыль для сохранения положения элемента на графе
        function node_onDblCLick(nodeElement) {
            var parent = nodeElement.parentElement;
            diagram_onDblClick([
                {name: 'node_id', value: parent.id}
            ]);
        }
	</script>

				<div class="ui-dashboard-header">
					<dl class="name-value width-200" style="display: inline-block;">
						<dt>
							<p:outputLabel for="initailPhaseName"
										   value="Первоначальное состояние:"/>
						</dt>
						<dd>
							<p:selectOneMenu id="initailPhaseName" value="#{lifecycleInfoFrameModel.lifecycle.initialPhase}">
								<p:ajax event="change" listener="#{lifecycleInfoFrameModel.changeInitialPhase}" />
								<f:selectItem itemLabel="Не выбран" noSelectionOption="true"
											  itemDisabled="true"/>
								<f:selectItems value="#{lifecycleInfoFrameModel.phases}" var="p"
											   itemLabel="#{p.phaseName}" itemValue="#{p}"/>
							</p:selectOneMenu>
						</dd>
					</dl>
					<p:outputPanel id="tree_buttons_panel" styleClass="m-fright">
						<p:commandLink id="create_transition_button" styleClass="m-mar-left10"
									   update="lifecycle_phase_add_dlg_form-lifecycle_phase_add_dlg"
									   actionListener="#{lifecycleInfoFrameModel.createTransition}">
							<i class="fa fa-random icon-btn"/>
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.lifecycle}"
														 target="#{lifecyclePhaseAddDialogModel.lifecycle}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.phases}"
														 target="#{lifecyclePhaseAddDialogModel.phases}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.phaseCreationMode}"
														 target="#{lifecyclePhaseAddDialogModel.phaseCreationMode}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.createNewPhaseTransition()}"
														 target="#{lifecyclePhaseAddDialogModel.transitionCallback}"/>
						</p:commandLink>
						<p:commandLink id="create_phase_button" styleClass="m-mar-left10"
									   update="lifecycle_phase_add_dlg_form-lifecycle_phase_add_dlg"
									   actionListener="#{lifecycleInfoFrameModel.createPhase}">
							<i class="fa fa-file-o icon-btn"/>
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.lifecycle}"
														 target="#{lifecyclePhaseAddDialogModel.lifecycle}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.phases}"
														 target="#{lifecyclePhaseAddDialogModel.phases}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.phaseCreationMode}"
														 target="#{lifecyclePhaseAddDialogModel.phaseCreationMode}" />
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.createNewPhase()}"
														 target="#{lifecyclePhaseAddDialogModel.phaseCallback}"/>
							<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.createNewPhaseTransition()}"
														 target="#{lifecyclePhaseAddDialogModel.transitionCallback}"/>
						</p:commandLink>
					</p:outputPanel>
				</div>
				<p:diagram value="#{lifecycleInfoFrameModel.model}" style="height:600px; width: 100%;" styleClass="ui-widget-content"
						var="phase">
					<f:facet name="element">
						<div onmouseleave="node_onMouseOut(this)" ondblclick="node_onDblCLick(this)" id="moveControlDiv#{phase.id}">
							<h:outputText value="#{phase.phaseName}" style="display:block;margin-top:1em;"/>
						</div>
					</f:facet>
				</p:diagram>
				<p:remoteCommand name="diagram_onNodeMove" actionListener="#{lifecycleInfoFrameModel.onNodeMove}"/>
				<p:remoteCommand name="diagram_onDblClick" actionListener="#{lifecycleInfoFrameModel.onNodeClick}"
								 update="lifecycle_phase_view_dlg_form-lifecycle_phase_view_dlg">
					<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.selectedphase}"
												 target="#{lifecyclePhaseViewDialogModel.selectedPhase}" />
					<f:setPropertyActionListener value="#{lifecycleInfoFrameModel.phases}"
												 target="#{lifecyclePhaseViewDialogModel.phases}" />
				</p:remoteCommand>


</ui:composition>