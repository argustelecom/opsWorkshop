<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
				xmlns:o="http://omnifaces.org/ui" xmlns:f="http://java.sun.com/jsf/core">

	<h:form id="bills_wizard_recalc_form">
		<f:loadBundle var="billBundle" basename="BillBundle"/>
		<o:importConstants type="ru.argustelecom.box.env.billing.bill.BillParamsDto.BillContext" var="contextType"/>
		<o:importConstants type="ru.argustelecom.box.env.billing.bill.BillMassRecalcDialogModel.Step" var="stepType"/>

		<p:dialog id="bills_recalc_dlg" styleClass="icon-edit-dialog"
				  header="#{billBundle['box.bill.plural.recalculate_dlg']}" width="650"
				  widgetVar="billsRecalcDlgVar" resizable="false" modal="true" closable="false">

			<p:wizard id="bills_recalc_wizard" showNavBar="false"
					  widgetVar="billsRecalcWizard" styleClass="dialog-nav-wizard">

				<p:tab id="#{stepType.FIND.id}" title="#{overallBundle['box.overall.step1']}">
					<ui:include src="BillParamsFrame.xhtml">
						<ui:param name="billParams" value="#{billMassRecalcDm.billParams}" />
					</ui:include>
					<div class="m-container100 m-responsive100">
						<dl class="name-value width-150 name-value-tooltip">
							<dt class="width-90-percents">
                    			<p:outputLabel for="send_bills" value="#{billBundle['box.bill.plural.recalculate.resending']}:"/>
                			</dt>
                			<dd class="width-10-percents">
                				<p:selectBooleanCheckbox id="send_bills" value="#{billMassRecalcDm.needSendBills}"/>
                			</dd>
						</dl>
					</div>
					<h:panelGroup layout="block" styleClass="m-disp-block" class="dialog-footer-buttons">
						<p:commandButton id="recalc_cancel_button" value="#{overallBundle['box.overall.cancel']}"
										 styleClass="m-blue-text-button" process="@this" action="#{billMassRecalcDm.onCancel()}"
										 onclick="PF('billsRecalcDlgVar').hide()"/>

						<p:commandButton value="#{overallBundle['box.overall.forward']}"
										 action="#{billMassRecalcDm.findBills()}"
										 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('billsRecalcWizard').next();}"/>
					</h:panelGroup>
				</p:tab>

				<p:tab id="#{stepType.CONFIRM.id}" title="#{overallBundle['box.overall.step2']}">
					<div class="m-container100 m-responsive100 clearfix">
						<ui:fragment rendered="#{not billMassRecalcDm.needSendBills}">
							<div class="message message-icon message-icon-info">
								<p>#{billBundle['box.bill.plural.recalculate.count']} #{billMassRecalcDm.bills.size()}</p>
							</div>
						</ui:fragment>

						<ui:fragment rendered="#{billMassRecalcDm.needSendBills}">
							<div class="message message-icon message-icon-info">
								<p>#{billBundle['box.bill.plural.recalculate.send.count']} #{billMassRecalcDm.bills.size()}</p>
							</div>
							<ui:fragment rendered="#{not empty billMassRecalcDm.billErrorReportDtoList}">
								<div class="message message-icon message-icon-warn">
									<p>#{billBundle['box.bill.plural.send.without_email_msg']} - #{billMassRecalcDm.billsWithoutEmailNumber}</p>
								</div>
								<div class="message message-icon message-icon-warn">
									<p>#{billBundle['box.bill.plural.send.without_template_msg']} - #{billMassRecalcDm.billsWithoutTemplateNumber}</p>
									<p:commandLink title="#{billBundle['box.bill.plural.send.download_text']}" immediate="true" ajax="false"
								   					icon="fa fa-download" styleClass="bill-send-download">
										<i class="icon-get_app fs20"/>
										<p:fileDownload value="#{billMassRecalcDm.onDownload()}"/>
										<h:outputText styleClass="bill-send-download-text" value="#{billBundle['box.bill.plural.send.download_text']}"/>
									</p:commandLink>
								</div>
							</ui:fragment>
						
						
							<dl class="name-value width-160">
								<dt>
									<p:outputLabel for="name" value="#{overallBundle['box.overall.name']}:" />
								</dt>
								<dd>
									<p:inputText id="name" value="#{billMassRecalcDm.senderName}" required="true"
								 				label="#{overallBundle['box.overall.name']}"/>
								</dd>

								<dt>
									<p:outputLabel for="send_date" value="#{billBundle['box.bill.send.start_date_sending']}"/>
								</dt>
								<dd>
									<p:calendar id="send_date" pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}" styleClass="width-100-percents"
												value="#{billMassRecalcDm.sendDate}" locale="#{languageBean.locale.language}">
										<f:validator validatorId="billMassSendDateValidator"/>
									</p:calendar>
								</dd>
							</dl>
						</ui:fragment>
					</div>

					<h:panelGroup layout="block" styleClass="m-disp-block" class="dialog-footer-buttons">

						<p:commandButton id="confirm_cancel_button" value="#{overallBundle['box.overall.cancel']}"
										 styleClass="m-blue-text-button"
										 onclick="PF('billsRecalcDlgVar').hide(); PF('billsRecalcWizard').loadStep('#{stepType.FIND.id}', true)"
										 action="#{billMassRecalcDm.onCancel()}" process="@this"/>

						<p:commandButton id="bill_recalc_button" value="#{billBundle['box.bill.recalculate']}"
										 oncomplete="PF('billsRecalcDlgVar').hide(); PF('billsRecalcWizard').loadStep('#{stepType.FIND.id}', false)"
										 action="#{billMassRecalcDm.recalc()}" disabled="#{empty billMassRecalcDm.bills 
										 	or (billMassRecalcDm.needSendBills and (billMassRecalcDm.billsWithoutEmailNumber > 0 or billMassRecalcDm.billsWithoutTemplateNumber > 0))}">
						</p:commandButton>
					</h:panelGroup>

				</p:tab>
			</p:wizard>

		</p:dialog>
	</h:form>
</ui:composition>