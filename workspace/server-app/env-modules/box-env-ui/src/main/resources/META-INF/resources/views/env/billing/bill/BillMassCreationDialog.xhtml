<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
				xmlns:o="http://omnifaces.org/ui" xmlns:f="http://java.sun.com/jsf/core">

	<h:form id="bills_wizard_create_form">
		<f:loadBundle var="billBundle" basename="BillBundle"/>
		<o:importConstants type="ru.argustelecom.box.env.billing.bill.BillParamsDto.BillContext" var="contextType"/>
		<o:importConstants type="ru.argustelecom.box.env.billing.bill.BillCreationDialogModel.Step" var="stepType"/>

		<p:dialog id="bills_create_dlg" styleClass="icon-edit-dialog"
				  header="#{billBundle['box.bill.plural.create_dlg']}" width="650"
				  widgetVar="billsCreateDlgVar" resizable="false" modal="true" closable="false">

			<p:wizard id="bills_create_wizard" flowListener="#{billCreationDm.onFlowProcess}" showNavBar="false"
					  widgetVar="billsWizard" styleClass="dialog-nav-wizard">

				<p:tab id="#{stepType.CREATION.id}" title="#{billBundle['box.bill.plural.create_dialog.step1']}">
					<ui:include src="BillParamsFrame.xhtml">
						<ui:param name="billParams" value="#{billCreationDm.billParams}" />
					</ui:include>
					<h:panelGroup layout="block" styleClass="m-disp-block" class="dialog-footer-buttons">
						<p:commandButton id="creation_cancel_button" value="#{overallBundle['box.overall.cancel']}"
										 styleClass="m-blue-text-button" process="@this"
										 onclick="PF('billsCreateDlgVar').hide()"
										 action="#{billCreationDm.onCancel()}"/>

						<p:commandButton value="#{overallBundle['box.overall.forward']}"
										 action="#{billCreationDm.validateBeforeMassCreation()}"
										 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('billsWizard').next();}"/>
					</h:panelGroup>

				</p:tab>

				<p:tab id="#{stepType.CONFIRM.id}" title="#{billBundle['box.bill.plural.create_dialog.step2']}">
					<div class="m-container100 m-responsive100 clearfix">

						<ui:fragment rendered="#{not empty billCreationDm.validBillGroups}">
							<div class="message message-icon message-icon-info">
								<p>#{billBundle['box.bill.plural.create_dlg.info_msg.create']} - #{billCreationDm.validBillGroups.size()}</p>
							</div>
						</ui:fragment>

						<!-- TODO исправить: div показывается безусловно  -->
						<div class="message message-icon message-icon-warn">
							<ui:fragment rendered="#{empty billCreationDm.validBillGroups}">
								<p>#{billBundle['box.bill.plural.create_dlg.info_msg.no_param']}</p>
							</ui:fragment>

							<ui:fragment rendered="#{not empty billCreationDm.billErrorReportDtoList}">
								<p>#{billBundle['box.bill.plural.create_dlg.info_msg.uniqueness']} #{billCreationDm.billErrorReportDtoList.size()}</p>
								<p:commandLink title="#{overallBundle['box.overall.download']}" ajax="false" icon="fa fa-download">
									<i class="icon-get_app fs20 m-bold-gray"/>
									<p:fileDownload value="#{billCreationDm.onDownload()}"/>
									<h:outputText value="#{billBundle['box.bill.plural.create_dlg.download_text']}"/>
								</p:commandLink>
							</ui:fragment>
							<ui:fragment rendered="#{not empty billCreationDm.validBillGroups and empty billCreationDm.billErrorReportDtoList}">
								<p><h:outputFormat value="#{billBundle['box.bill.plural.create_dlg.info_msg.bills_amount']}">
									<f:param value="#{billCreationDm.validBillGroups.size()}" />
								</h:outputFormat></p>
							</ui:fragment>
						</div>
					</div>

					<h:panelGroup layout="block" styleClass="m-disp-block" class="dialog-footer-buttons">
						<p:commandButton id="back_button" value="#{overallBundle['box.overall.back']}" oncomplete="PF('billsWizard').back();"/>

						<p:commandButton id="confirm_cancel_button" value="#{overallBundle['box.overall.cancel']}"
										 styleClass="m-blue-text-button"
										 oncomplete="PF('billsCreateDlgVar').hide(); PF('billsWizard').loadStep('#{stepType.CREATION.id}', false)"
										 action="#{billCreationDm.onCancel()}" process="@this"/>

						<p:commandButton id="bill_create_button" value="#{overallBundle['box.overall.save']}"
										 oncomplete="PF('billsCreateDlgVar').hide(); PF('billsWizard').loadStep('#{stepType.CREATION.id}', false)"
										 action="#{billCreationDm.createBills()}"
										 disabled="#{empty billCreationDm.validBillGroups}">
						</p:commandButton>
					</h:panelGroup>

				</p:tab>
			</p:wizard>

		</p:dialog>
	</h:form>
</ui:composition>