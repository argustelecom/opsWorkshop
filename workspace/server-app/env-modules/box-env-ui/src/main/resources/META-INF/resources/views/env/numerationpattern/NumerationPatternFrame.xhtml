<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:o="http://omnifaces.org/ui">

	<f:loadBundle var="numerationBundle" basename="NumerationBundle"/>
	<div class="m-card m-hei-auto-on-mobile m-pad-0">
		<div class="m-container100">
			<h:form id="num_pattern_form">
				<div id="num_pattern_data" class="m-container60 m-responsive100">
					<p:treeTable id="num_pattern_tree_table" value="#{numerationPatternFm.root}"
								 var="element" styleClass="tree-table-no-header tree-table-no-border tree-table-num-pattern">
						<p:column styleClass="first-column">
							<p:outputLabel value="#{element.nodeName}" rendered="#{element.typeDto ne null}"/>
							<p:commandLink value="#{element.nodeName}"
                                           title="#{numerationBundle['box.numeration.pattern.get_info']} #{element.nodeName}"
										   styleClass="m-disp-inl-block m-bold-gray info-hover"
										   rendered="#{element.typeDto eq null}"
										   process="@this"
										   update="num_pattern_tab_view-num_pattern_form-num_pattern_variable">
								<f:setPropertyActionListener value="#{element.nodeType}" target="#{numerationPatternFm.selectedNodeType}"/>
							</p:commandLink>
						</p:column>
						<p:column styleClass="width-60-percents">
							<p:inputText value="#{element.numerationPatternDto.pattern}" disabled="#{!element.edit}"
										 styleClass="width-100-percents"/>
						</p:column>

						<p:column styleClass="width-25 #{!element.edit ? 'm-disp-table-cell':'hide'}">
							<p:commandLink title="#{overallBundle['box.overall.edit']}"
										   action="#{numerationPatternFm.invert(element)}"
										   update="num_pattern_tree_table num_pattern_tab_view-num_pattern_form-num_pattern_variable"
										   disabled="#{!p:ifGranted('System_NumMaskEdit')}">
								<i class="icon-create fs20 icon-btn m-disp-inl-block neg-margin-top-15"/>
								<f:setPropertyActionListener value="#{element.nodeType}" target="#{numerationPatternFm.selectedNodeType}"/>
							</p:commandLink>
						</p:column>

						<p:column styleClass="width-25 #{element.edit ? 'm-disp-table-cell':'hide'}">
							<p:commandLink title="#{overallBundle['box.overall.save']}" action="#{numerationPatternFm.onSave()}"
										   update="num_pattern_tree_table num_pattern_tab_view-sequence_search_result_form-sequence_table">
								<i class="icon-save fs20 icon-btn m-disp-inl-block neg-margin-top-15"/>
								<f:setPropertyActionListener value="#{element}" target="#{numerationPatternFm.selectedNumerationPatternNodeData}"/>
								<p:ajax listener="#{numerationSequenceFrameModel.lazyDm.reloadData()}"/>
							</p:commandLink>
						</p:column>
						<p:column styleClass="width-25 #{element.edit ? 'visibility':'visibility-hidden'}">
							<p:commandLink id="show_num_pattern_button"
										   action="#{numerationPatternFm.createPreviewPattern()}"
										   process="@form" update="num_pattern_tab_view-num_pattern_form-party_type_creation_panel"
										   oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('numPatternWidget').show('#{component.clientId}')}"
										   title="#{numerationBundle['box.numeration.pattern.show_example']}">
								<i class="icon-visibility fs20 icon-btn m-disp-inl-block neg-margin-top-15"/>
								<f:setPropertyActionListener value="#{element}" target="#{numerationPatternFm.selectedNumerationPatternNodeData}"/>
							</p:commandLink>

						</p:column>
					</p:treeTable>
					<p:overlayPanel widgetVar="numPatternWidget" dismissable="true" hideEffect="fade">
						<p:outputPanel id="party_type_creation_panel">
							<div class="m-pad10 m-soft-gray-back">
								<p class="data-overflow-ellipsis width-500">
									#{numerationBundle['box.numeration.pattern.example']}:
									<b>#{numerationPatternFm.previewPattern}</b>
								</p>

								<ui:fragment rendered="#{not numerationPatternFm.availableNumberLength}">
									<div class="message-error message-icon message-icon-error">
										#{numerationPatternFm.greaterThanMaxNumberLengthMsg}
									</div>
								</ui:fragment>
							</div>
						</p:outputPanel>
					</p:overlayPanel>
				</div>

				<o:importConstants type="ru.argustelecom.box.env.numerationpattern.NumerationPatternFrameModel.NodeType" var="nodeType"/>

				<div class="m-container40 m-responsive100">
					<div id="stick_block">
						<div class="message-info message-icon message-icon-info white-back num-pattern">
							<h:panelGroup id="num_pattern_variable" layout="block" styleClass="#{numerationPatternFm.selectedNodeType ne null or numerationPatternFm.selectedNodeType eq nodeType.CONTRACT_EXT ? 'm-mar-bot10 bottom-border m-pad-bot5':''}">
								<ui:fragment rendered="#{numerationPatternFm.selectedNodeType ne null}">
									<p>
										<b>Настройка маски номера #{numerationPatternFm.selectedNodeType.name}</b>
									</p>
									<p><b>Доступные переменные:</b></p>

									<p><span class="monospace">{SysDate:ФорматДаты}</span> - системная дата создания.</p>
									<p>Формат Даты задается комбинацией букв <span class="monospace">у, M, d</span>, где <span class="monospace">у</span> - год, <span class="monospace">M</span> - месяц, <span class="monospace">d</span> - день.
										Количество букв определяет количество цифр: для года можно указать 2 или 4 (<span class="monospace">уу или уууу</span>),
										для месяца и дня - только 2 (<span class="monospace">MM, dd</span>).</p>
									<p>Примеры задания формата даты и генерации значения по заданному формату для системной даты 05.07.2017:</p>
									<ul>
										<li>Формат даты <span class="monospace">yyyyMMdd</span> -> Дата в номере <span class="monospace">20170705</span></li>
										<li>Формат даты <span class="monospace">yyMM</span> -> Дата в номере <span class="monospace">1707</span></li>
										<li>Формат даты <span class="monospace">MM</span> -> Дата в номере <span class="monospace">07</span></li>
									</ul>

									<ui:fragment
											rendered="#{numerationPatternFm.selectedNodeType eq nodeType.CONTRACT_EXT}">
										<p><span class="monospace">{ContractNum}</span> - номер связанного договора. Формата для переменной не предусмотрено.</p>
										<p>Пример маски, содеражащей переменную <span class="monospace">{ContractNum}: Доп_{ContractNum}-&#8249;s1&#8250;</span></p>
										<p>Номер доп.соглашения, сгенерированный для договора с номером Д0085 <span class="monospace">Доп_Д0085-1000</span></p>

										<p><span class="monospace">{ContractExtNum}</span> - номер доп.соглашения в рамках связанного договора. Формата для переменной не предусмотрено.</p>
										<p>Пример маски, содеражащей переменную <span class="monospace">{ContractExtNum}: Доп_{ContractNum}-{ContractExtNum}</span></p>
										<p>Номер третьего доп.соглашения, сгенерированный для договора с номером Д0085, - <span class="monospace">Доп_Д0085-3</span></p>
									</ui:fragment>
								</ui:fragment>
							</h:panelGroup>
							<p>Маска номера состоит из констант, переменных и последовательности номеров.</p>

							<p><b>Константы</b> - любые символы, кроме <span class="monospace">{ , } , &#8249; , &#8250;</span>.</p>
							<p class="m-pad-left20"><i>Пример.</i> Маска номера лицевого счета <span class="monospace">ЛС-***</span> начинается с символов <span class="monospace">ЛС-</span>.</p>
							<p><b>Последовательность</b> - параметр, определяющий правила нумерации объектов. В составе маски указывается имя последовательности в треугольных скобках: <span class="monospace">&#8249;ИмяПоследовательности&#8250;</span>. Последовательность номеров должна быть создана до ввода маски.</p>
							<p class="m-pad-left20"><i>Пример.</i> Маска номера содержит элемент <span class="monospace">&#8249;s1&#8250;</span>, это означает, что при нумерации выбранного объекта будет использоваться последовательность с именем <span class="monospace">s1</span></p>
							<p><b>Переменные.</b> Для каждого объекта системы определен свой список переменных. Переменные задаются  в фигурных скобках: указывается имя переменной, а далее, если это необходимо, - указывается формат: <span class="monospace">{ИмяПеременной:Формат}</span>.</p>
							<p class="m-pad-left20"><i>Пример:</i> Маска номера содержит элемент <span class="monospace">{SysDate:yy}</span>, где <span class="monospace">SysDate</span> - имя переменной, определяющей системную дату создания объекта; формат - <span class="monospace">yy</span>, 2 значимые цифры года.</p>

							<p class="m-mar-top10"><i>Пример маски номера.</i></p>
							<p>Маска: <span class="monospace">Д-&#8249;s1&#8250;-{SysDate:yyMMdd}</span>,
								где <span class="monospace">s1</span> - последовательность с Разрядностью 4, Начальным номером 1000, Шагом 1, без ограничений по Периоду, с текущим значением 1256</p>
							<p>Номер, сгерерированный по этой маске для договора, созданного 21.08.2017, будет: <span class="monospace">Д-1257-170821</span></p>
							<p>Чтобы узнать подробнее о переменных объекта - нажмите на название объекта в дереве.</p>
						</div>
					</div>
					<script type="text/javascript">
                        $(document).ready(function () {
							Argus.System.AutoHeight.compute('num_pattern_tab_view-num_pattern_form', 180);
							$(window).scroll(Argus.System.Scroll.stick('stick_block','num_pattern_data','num_pattern_tab_view-num_pattern_form'));
                        });
					</script>
				</div>
			</h:form>
		</div>
	</div>

</ui:composition>