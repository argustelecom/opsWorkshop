<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:pm="http://primefaces.org/modena" xmlns:f="http://java.sun.com/jsf/core">

	<f:loadBundle var="locationBundle" basename="LocationBundle"/>
	<div class="m-container100">
		<div class="m-container-indent">
			<div class="m-card m-shadow-effect simple-fb">

				<h:form id="building_form">

					<f:attribute name="updateEvent" value="#{currentLocation.changedEvent}"/>
					<f:event listener="#{addressBuildingsFM.preRender()}" type="preRenderComponent"/>

					<script>
						$( document ).ready(function() {
							Argus.System.AutoHeight.compute('building_form', 40);
						});
					</script>

					<div class="ui-dashboard-header">
						<i class="fa fa-building" />
						<h:outputText value="#{locationBundle['box.location.structure.building']}" styleClass="card-header"/>

						<p:outputPanel id="managed_buttons" styleClass="m-fright">
							<p:commandLink styleClass="m-mar-left10" process="@this"
											 title="#{overallBundle['box.overall.add']}" update="building_table" action="#{buildingEditDlgM.onDialogOpen()}"
											 disabled="#{!p:ifGranted('System_AddressStructureEdit') or addressBuildingsFM.parent.parent eq null}">
											<i class="fa fa-edit icon-btn"/>
											<f:setPropertyActionListener value="#{addressBuildingsFM.parent}" target="#{buildingEditDlgM.parent}"/>
											<f:setPropertyActionListener value="#{addressBuildingsFM.buildingCallback}" target="#{buildingEditDlgM.buildingCallback}"/>
							</p:commandLink>

							<p:commandLink styleClass="m-mar-left10" action="#{addressBuildingsFM.removeBuildings()}" title="#{overallBundle['box.overall.delete']}" update="building_table"
											 disabled="#{!p:ifGranted('System_AddressStructureEdit') or addressBuildingsFM.selectedBuildings == null or empty addressBuildingsFM.selectedBuildings}">
											<i class="fa fa-trash icon-btn"/>
											<p:confirm header="#{locationBundle['box.location.structure.building.delete_dialog']}"
													   message="#{locationBundle['box.location.structure.building.delete_dialog.details']}"/>
							</p:commandLink>
						</p:outputPanel>
					</div>

					<p:dataTable id="building_table" value="#{addressBuildingsFM.buildings}" var="building" rowKey="#{building.id}"
								 selection="#{addressBuildingsFM.selectedBuildings}" scrollable="true" scrollHeight="90%"
								 emptyMessage="#{overallBundle['box.overall.empty']}">

						<p:ajax event="rowSelectCheckbox" update="building_form-managed_buttons"/>
						<p:ajax event="rowUnselectCheckbox" update="building_form-managed_buttons"/>
						<p:ajax event="rowSelect" update="building_form-managed_buttons"/>
						<p:ajax event="rowUnselect" update="building_form-managed_buttons"/>
						<p:ajax event="toggleSelect" update="building_form-managed_buttons"/>

						<p:column selectionMode="multiple" styleClass="width-16 m-tex-al-center"/>

						<p:column headerText="#{overallBundle['box.overall.id']}">
							<h:outputText value="#{building.id}"/>
						</p:column>

						<p:column headerText="#{locationBundle['box.location.structure.building.number']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText id="number_out" value="#{building.number}"/>
								</f:facet>

								<f:facet name="input">
									<p:inputText id="number_in" value="#{building.number}" maxlength="10" required="true"
												 styleClass="width-95-percents"/>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{locationBundle['box.location.structure.building.corpus']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText id="corpus_out" value="#{building.corpus}"/>
								</f:facet>

								<f:facet name="input">
									<p:inputText id="corpus_in" value="#{building.corpus}" maxlength="10" styleClass="width-95-percents"/>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{locationBundle['box.location.structure.building.wing']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText id="wing_out" value="#{building.wing}"/>
								</f:facet>

								<f:facet name="input">
									<p:inputText id="wing_in" value="#{building.wing}" maxlength="10" styleClass="width-95-percents"/>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{locationBundle['box.location.structure.building.landmark']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText id="landmark_out" value="#{building.landmark}"/>
								</f:facet>

								<f:facet name="input">
									<p:inputTextarea id="landmark_in" value="#{building.landmark}" maxlength="512" styleClass="width-95-percents"/>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{locationBundle['box.location.structure.building.postal_index']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText id="post_index_out" value="#{building.postIndex}"/>
								</f:facet>

								<f:facet name="input">
									<p:inputText id="post_index_in" value="#{building.postIndex}" maxlength="50" styleClass="width-95-percents"/>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column styleClass="width-20" rendered="#{p:ifGranted('System_AddressStructureEdit')}">
							<p:commandLink update="building_edit_form" oncomplete="PF('buildingEditDlgVar').show()"
										   title="#{overallBundle['box.overall.edit']}">
								<i class="icon-create fs20 m-bold-gray"/>
								<f:setPropertyActionListener value="#{building}" target="#{buildingEditDlgM.building}" />
							</p:commandLink>
						</p:column>
						<p:column styleClass="width-20"
								  rendered="#{addressBuildingsFM.hasNriStructure() and p:ifGranted('Nri_BuildingStructureEdit')}">
							<p:link title="#{locationBundle['box.location.building_passport']}"
									outcome="/views/nri/building/BuildingStructureView.xhtml?location=Building-#{building.id}">
								<i class="fa fa-th m-bold-gray"/>
							</p:link>
						</p:column>

					</p:dataTable>

				</h:form>
		
			</div>
		</div>
	</div>

</ui:composition>