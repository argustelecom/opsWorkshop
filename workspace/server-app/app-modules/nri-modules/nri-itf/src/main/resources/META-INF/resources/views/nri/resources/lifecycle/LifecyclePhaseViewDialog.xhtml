<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:f="http://java.sun.com/jsf/core">
	<style type="text/css">
		.ui-row-editor{
			display: inline;
		}
	</style>
	<h:form id="lifecycle_phase_view_dlg_form">
	<p:dialog id="lifecycle_phase_view_dlg"
			  header="Статус логического ресурса"
			  widgetVar="lifecyclePhaseViewDlg" resizable="false" modal="true" closable="false"
			  styleClass="icon-creation" style="max-width: 75%; min-width: 50%;">
		<f:facet name="header">
			<h:outputText value="Статус логического ресурса"/>
		</f:facet>
		<p:panel>
			<p:outputPanel id="buttons_panel" styleClass="m-fright">
				<p:commandLink id="delPhaseBtn"
							   action="#{lifecyclePhaseViewDialogModel.removePhase}"
							   update="#{update} newPhaseSelectionDlg" process="@this"
							   oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('lifecyclePhaseViewDlg').hide();}">
					<i class="fa fa-trash"/>
				</p:commandLink>
			</p:outputPanel>
			<sysinf:editableSection>
				<p:ajax event="save" process="@this"
						listener="#{lifecyclePhaseViewDialogModel.changePhaseInfo()}"/>
				<dl class="name-value width-200">
					<dt>
						<p:outputLabel for="phaseName"
									   value="Название состояния:"/>
					</dt>
					<dd>
						<p:inputText id="phaseName" value="#{lifecyclePhaseViewDialogModel.selectedPhase.phaseName}" required="true"/>
					</dd>
				</dl>
			</sysinf:editableSection>
			<dl>
				<dt>
					<p:outputLabel for="outcomingPhases"
								   value="В состояние"/>
				</dt>
				<dd>
					<p:dataTable id="outcomingPhases" var="outcomingPhase" styleClass="newOutcomingPhasesWidget"
								 value="#{lifecyclePhaseViewDialogModel.outcomingPhases}"
								 editable="true" style="margin-bottom:20px">
						<p:ajax event="rowEditCancel" listener="#{lifecyclePhaseViewDialogModel.cancelEditNewOutcomingPhase}"
								update="outcomingPhases addNewOutcomingPhasesBtn"/>
						<p:ajax event="rowEdit" listener="#{lifecyclePhaseViewDialogModel.acceptEditNewOutcomingPhase}"
								update="outcomingPhases addNewOutcomingPhasesBtn"/>
						<p:column headerText="Действие">
							<p:cellEditor>
								<f:facet name="output"><h:outputText value="#{outcomingPhase.comment}" /></f:facet>
								<f:facet name="input">
									<p:inputText value="#{outcomingPhase.comment}" required="true"
										style="width: 100%;"/>
								</f:facet>
							</p:cellEditor>
						</p:column>
						<p:column headerText="В состояние">
							<p:cellEditor>
								<f:facet name="output"><h:outputText value="#{outcomingPhase.outcomingPhase.phaseName}" /></f:facet>
								<f:facet name="input">
									<p:selectOneMenu value="#{outcomingPhase.outcomingPhase}" required="true"
											disabled="#{outcomingPhase.id ne null}">
										<f:selectItems value="#{lifecyclePhaseViewDialogModel.phases}" var="p"
													   itemLabel="#{p.phaseName}" itemValue="#{p}"/>
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>
						<p:column style="width:50px">
							<f:facet name="header">
								<p:commandLink id="addNewOutcomingPhasesBtn"
											   rendered="#{lifecyclePhaseViewDialogModel.lastAddedNewOutcomingPhase eq null}"
											   update="outcomingPhases" process="@this"
											   oncomplete="jQuery('.newOutcomingPhasesWidget tr').last().find('span.ui-icon-pencil').each(function(){jQuery(this).click()});"
											   action="#{lifecyclePhaseViewDialogModel.addNewOutcomingPhase}">
									<i class="fa fa-plus icon-btn"/>
								</p:commandLink>
							</f:facet>
							<p:rowEditor>
								<p:commandLink id="delOutcomingPhasesBtn"
														update="outcomingPhases addNewOutcomingPhasesBtn" process="@this"
														action="#{lifecyclePhaseViewDialogModel.deleteTransition(outcomingPhase)}">
									<i class="fa fa-minus ui-icon-circlesmall-minus"/>
								</p:commandLink>
							</p:rowEditor>
						</p:column>
					</p:dataTable>
				</dd>
			</dl>
		</p:panel>
		<div class="dialog-footer-buttons">
			<p:commandButton id="close_button"
							 value="Ok"
							 update="#{update}" process="@this"
							 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('lifecyclePhaseViewDlg').hide();}"/>
		</div>

	</p:dialog>

		<p:dialog id="newPhaseSelectionDlg"
					  header="Новый статус для ресурсов в статусе #{lifecyclePhaseViewDialogModel.selectedPhase.phaseName}"
					  widgetVar="newPhaseSelectionDlg" resizable="false" modal="true" closable="false"
					  styleClass="icon-creation" style="max-width: 75%; min-width: 50%;">
			<p:selectOneMenu value="#{lifecyclePhaseViewDialogModel.substitutingPhase}" required="true"
							 disabled="#{outcomingPhase.id ne null}">
				<f:selectItems value="#{lifecyclePhaseViewDialogModel.phases}" var="p"
							   itemLabel="#{p.phaseName}" itemValue="#{p}"/>
			</p:selectOneMenu>
			<div class="dialog-footer-buttons">
				<p:commandButton id="close_selection_button"
								 value="Удалить"
								 action="#{lifecyclePhaseViewDialogModel.removeWithSubstitution}"
								 update="#{update}" process="@this"
								 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('newPhaseSelectionDlg').hide();}"/>
			</div>
		</p:dialog>
	</h:form>
</ui:composition>