<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui"
				xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:boxenv="http://argustelecom.ru/box/env">

	<ui:param name="viewModel" value="#{personalAccountViewModel}"/>
	<ui:param name="pageTitle" value="#{personalAccountBundle['box.personal_account']}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="personalAccount" value="#{currentPersonalAccount.value}" required="#{!facesContext.postback}"/>
		</f:metadata>
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet name="box-env/styles/box-env.css"/>
		<h:outputStylesheet name="inf/styles/box-functional-block.css"/>

		<f:loadBundle basename="ContractBundle" var="contractBundle"/>
		<f:loadBundle basename="OverallBundle" var="overallBundle"/>
	</ui:define>

	<ui:define name="pagePath">
		<f:loadBundle basename="OverallBundle" var="overallBundle"/>
		<f:loadBundle basename="PersonalAccountBundle" var="personalAccountBundle"/>

		<p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml"/>
		<p:menuitem value="#{personalAccountBundle['box.personal_account.customer.plural']}" url="/views/env/customer/CustomerListView.xhtml" />
		<o:importConstants type="ru.argustelecom.box.env.page.navigation.CardType" var="cardType"/>
		<p:menuitem value="#{currentPersonalAccount.value.customer.objectName}" disabled="#{!p:ifGranted(cardType.CUSTOMER.permissionId)}" 
					url="#{cardNavigator.getOutcome(currentPersonalAccount.value.customer)}"/>
		<p:menuitem value="#{personalAccountViewModel.account.objectName}"/>
	</ui:define>

	<ui:define name="body">

		<ui:include src="PersonalAccountAttributesFrame.xhtml"/>

		<o:importConstants type="ru.argustelecom.box.env.billing.bill.BillParamsDto.BillContext" var="contextType"/>

		<div class="m-container100 m-responsive100">
			<ui:include src="/views/env/billing/subscription/SubscriptionsFrame.xhtml">
				<ui:param name="personalAccount" value="#{personalAccountViewModel.account}"/>
			</ui:include>
		</div>

		<ui:include src="/views/env/billing/bill/BillsFunctionalBlock.xhtml">
			<ui:param name="currentContext" value="#{contextType.PERSONAL_ACCOUNT}"/>
			<ui:param name="personalAccount" value="#{personalAccountViewModel.account}"/>
			<ui:param name="containerClass" value="m-container100"/>
			<ui:param name="canCreateBill" value="true"/>
		</ui:include>

		<div class="m-container50 m-responsive100">
			<ui:include src="/views/env/customer/CustomerAttributesBlockFrame.xhtml">
				<ui:param name="customer" value="#{personalAccountViewModel.account.customer}"/>
			</ui:include>

			<ui:include src="/views/env/billing/privilege/PrivilegeFrame.xhtml">
				<ui:param name="privilegeSubject" value="#{personalAccountViewModel.privilegeSubject}"/>
			</ui:include>
		</div>

		<div class="m-container50 m-responsive100">
			<ui:include src="/views/env/billing/invoice/InvoiceFrame.xhtml">
				<ui:param name="personalAccount" value="#{personalAccountViewModel.account}"/>
				<ui:param name="frameHeight" value="300"/>
			</ui:include>

			<ui:include src="/views/env/billing/transaction/TransactionFrame.xhtml">
				<ui:param name="personalAccount" value="#{personalAccountViewModel.account}"/>
				<ui:param name="frameHeight" value="400"/>
			</ui:include>
		</div>

	</ui:define>

	<ui:define name="dialogs">
		<ui:include src="/views/env/billing/subscription/SubscriptionCreationByContractDialog.xhtml">
			<ui:param name="update" value="subscriptions_form"/>
		</ui:include>

		<ui:include src="/views/env/lifecycle/LifecycleRoutingDialog.xhtml">
			<ui:param name="update" value="subscriptions_form invoice_frame_form"/>
		</ui:include>

		<ui:include src="/views/env/billing/privilege/PrivilegeEditDialog.xhtml">
			<ui:param name="update" value="privilege_form"/>
		</ui:include>

		<ui:include src="/views/env/billing/bill/BillCreationDialog.xhtml">
			<ui:param name="update" value="bill_fb_form-bills"/>
		</ui:include>

		<ui:include src="/views/env/billing/privilege/ExtendPrivilegeDialog.xhtml">
			<ui:param name="update" value="privilege_form"/>
		</ui:include>

		<ui:include src="/views/env/billing/privilege/PrivilegeRemoveDialog.xhtml">
			<ui:param name="update" value="privilege_form"/>
		</ui:include>

	</ui:define>

</ui:composition>