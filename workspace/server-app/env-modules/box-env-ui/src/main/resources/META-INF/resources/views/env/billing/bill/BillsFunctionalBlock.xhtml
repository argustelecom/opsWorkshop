<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:boxenv="http://argustelecom.ru/box/env"
				xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:o="http://omnifaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core">


	<ui:fragment rendered="#{p:ifGranted('Billing_BillView')}">
		<div class="#{containerClass eq null ? 'm-container50' : containerClass} m-responsive100">
			<div class="m-container-indent">
				<div class="m-card m-shadow-effect m-hei-auto-on-mobile simple-fb">
					<h:form id="bill_fb_form">
						<o:importConstants
								type="ru.argustelecom.box.env.billing.bill.BillParamsDto.BillContext"
								var="contextType"/>

						<c:choose>
							<c:when test="#{currentContext eq contextType.CUSTOMER}">
								<f:event type="preRenderComponent"
										 listener="#{billsFunctionalBlockFm.preRender(customer)}"/>
							</c:when>
							<c:when test="#{currentContext eq contextType.CONTRACT}">
								<f:event type="preRenderComponent"
										 listener="#{billsFunctionalBlockFm.preRender(contract)}"/>
							</c:when>
							<c:when test="#{currentContext eq contextType.PERSONAL_ACCOUNT}">
								<f:event type="preRenderComponent"
										 listener="#{billsFunctionalBlockFm.preRender(personalAccount)}"/>
							</c:when>
						</c:choose>

						<f:loadBundle basename="BillBundle" var="billBundle"/>

						<div class="ui-dashboard-header">
							<i class="icon-receipt"/>
							<h:outputText styleClass="card-header" value="#{billBundle['box.bill.plural']}"/>

							<p:outputPanel styleClass="m-fright">
								<p:commandLink action="#{billsFunctionalBlockFm.onCreationDialogOpen()}"
											   disabled="#{!p:ifGranted('Billing_BillRecalculation')}"
											   title="#{billBundle['box.bill.create']}" rendered="#{canCreateBill}">
									<f:setPropertyActionListener value="#{currentContext}"
																 target="#{billCreationDm.billParams.currentContext}"/>
									<f:setPropertyActionListener value="#{billsFunctionalBlockFm.groupingObject}"
																 target="#{billCreationDm.billParams.groupingObject}"/>
									<f:setPropertyActionListener value="#{billsFunctionalBlockFm.customerDto}"
																 target="#{billCreationDm.billParams.customer}"/>
									<f:setPropertyActionListener value="#{billsFunctionalBlockFm.groupingMethod}"
																 target="#{billCreationDm.billParams.groupingMethod}"/>
									<f:setPropertyActionListener value="#{billsFunctionalBlockFm.callbackAfterCreation}"
																 target="#{billCreationDm.callbackAfterCreation}"/>
									<i class="fa fa-pencil-square-o icon-btn"/>
								</p:commandLink>
							</p:outputPanel>
						</div>

						<p:dataTable id="bills" value="#{billsFunctionalBlockFm.lazyDataModel}" lazy="true" var="bill"
									 paginator="true" tableStyle="table-layout: auto;" rowsPerPageTemplate="5,10,15"
									 rows="5"
									 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									 currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}"
									 styleClass="paginator-top-hidden"
									 emptyMessage="#{overallBundle['box.overall.empty']}">

							<p:column headerText="#{overallBundle['box.overall.id']}">
								<boxenv:linkToCard value="#{bill.getIdentifiable()}" text="#{bill.id}"/>
							</p:column>

							<p:column headerText="#{overallBundle['box.overall.number']}">
								<h:outputText value="#{bill.number}"/>
							</p:column>

							<p:column headerText="#{billBundle['box.bill.date']}">
								<h:outputText
										value="#{dateUtils.format(bill.billDate, dateUtils.DATE_FULL_PATTERN, TZ.userTimeZone)}"/>
							</p:column>

							<p:column headerText="#{overallBundle['box.overall.total']}">
								<boxenv:money value="#{bill.totalAmount}" size="fs14" unicolour="true"/>
							</p:column>

							<p:column headerText="#{billBundle['box.bill.type']}">
								<h:outputText value="#{bill.type.name}"/>
							</p:column>

							<p:column headerText="#{billBundle['box.bill.payment_condition']}"
									  rendered="#{currentContext ne contextType.CONTRACT}">
								<h:outputText value="#{bill.paymentCondition.name}"/>
							</p:column>

							<p:column headerText="#{billBundle['box.bill.grouping_method']}"
									  rendered="#{currentContext eq contextType.CUSTOMER}">
								<h:outputText value="#{bill.groupingMethod.name}"/>
							</p:column>

							<p:column headerText="#{billBundle['box.bill.period']}">
								<h:outputText value="#{bill.period.toString()}"/>
							</p:column>

						</p:dataTable>

					</h:form>


				</div>
			</div>
		</div>
	</ui:fragment>
	<ui:include src="/views/env/page/frame/NotGrantedFrame.xhtml">
		<ui:param name="headerIcon" value="fa fa-list-alt"/>
		<ui:param name="headerText" value="#{billBundle['box.bill.plural']}"/>
		<ui:param name="permission" value="#{permissionRepository.getPermission('Billing_BillView')}"/>
	</ui:include>

</ui:composition>