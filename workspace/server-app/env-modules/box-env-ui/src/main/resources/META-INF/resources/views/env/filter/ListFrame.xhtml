<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:pm="http://primefaces.org/modena" xmlns:boxenv="http://argustelecom.ru/box/env">

	<!--Шаблон для фрейма с фильтрами и результатами поиска
		Реализация шаблона XXXListFrame.xhtml через <ui:include/> включается на страницу XXXListView.xhtml в body

	Параметры, обязательные для определения во фреймах
	Потомки должны определять параметры:
	1) viewState - viewState для данной страницы;
	2) lazyDm - потомка BaseConvertibleDtoLazyDataModel;
	3) page - название страницы
	4) filterFormId - идентификатор формы поиска
	5) resultFormId - идентификатор формы с результатами
	Пример:
	<ui:param name="viewState" value="#{customerListViewState}"/>
	<ui:param name="lazyDm" value="#{customerListViewModel.lazyDm}"/>
	<ui:param name="page" value="CustomerListView.xhtml"/>
	<ui:param name="filterFormId" value="customer_search_form"/>
	<ui:param name="resultFormId" value="customer_search_result_form"/>
	-->

	<f:loadBundle var="filterBundle" basename="FilterBundle"/>
	<div class="m-container100 m-responsive100">
		<div class="m-container-indent">
			<div class="m-card m-shadow-effect m-hei-auto-on-mobile simple-fb toggle-container">
				<h:form id="#{empty filterFormId ? 'filter_form' : filterFormId}">
					<f:event listener="#{listFilterPresetFrameModel.preRender(viewState, page)}" type="preRenderView"/>

					<div class="ui-dashboard-header">
						<i class="fa fa-search"/>
						<h:outputText styleClass="card-header" value="#{filterBundle['box.filter.search']}"/>

						<ui:fragment rendered="#{listFilterPresetFrameModel.selectedListFilterPreset ne null}">
							<div class="filter-title-block">
								<h:outputText id="current-filter" title="#{filterBundle['box.filter.preset']}: #{listFilterPresetFrameModel.selectedListFilterPreset.name}"
											  value="#{filterBundle['box.filter.preset']}: #{listFilterPresetFrameModel.selectedListFilterPreset.name}"/>
							</div>
						</ui:fragment>

						<p:outputPanel styleClass="m-fright">
							<p:commandButton id="apply_filter_button" value="#{filterBundle['box.filter.preset.plural']}"
											 styleClass="m-blue-text-button m-raised-button" process="@this"/>
							<p:overlayPanel id="apply_filter_panel" widgetVar="listPresetPanelVar"
											for="apply_filter_button"
											styleClass="filter-overlay-panel">

								<p:commandLink id="save_as" value="#{overallBundle['box.overall.save_as']}" styleClass="filter-action"
                                               action="#{listFilterPresetFrameModel.createListFilterPreset()}"
                                               update="#{filterFormId} apply_filter_list">
									<f:setPropertyActionListener value="#{listFilterPresetFrameModel.createListFilterPresetDto()}"
																 target="#{listFilterPresetCreationDialogModel.listFilterPreset}"/>
									<f:setPropertyActionListener value="#{listFilterPresetFrameModel.selectedPresetCallback}"
																 target="#{listFilterPresetCreationDialogModel.selectedPresetCallback}"/>
								</p:commandLink>
								<p:commandLink id="save" value="#{overallBundle['box.overall.save']}" styleClass="filter-action"
                                               action="#{listFilterPresetFrameModel.createOrSave()}"
                                               update="#{filterFormId} apply_filter_list">
									<f:setPropertyActionListener value="#{listFilterPresetFrameModel.createListFilterPresetDto()}"
																 target="#{listFilterPresetCreationDialogModel.listFilterPreset}"/>
									<f:setPropertyActionListener value="#{listFilterPresetFrameModel.selectedPresetCallback}"
																 target="#{listFilterPresetCreationDialogModel.selectedPresetCallback}"/>
								</p:commandLink>

								<p:dataList id="apply_filter_list" value="#{listFilterPresetFrameModel.listFilterPresets}" var="preset" type="unordered"
											rendered="#{listFilterPresetFrameModel.listFilterPresets ne null}" emptyMessage="#{overallBundle['box.overall.empty']}">
									<f:facet name="header">
										#{filterBundle['box.filter.param.plural']}
									</f:facet>
									<div class="columns">
										<p:commandLink action="#{listFilterPresetFrameModel.applyListFilterPreset()}" styleClass="column"
													   value="#{preset.name}" update="#{update} #{resultFormId} apply_filter_list">
											<p:ajax listener="#{lazyDm.reloadData()}"/>
											<f:setPropertyActionListener value="#{preset}" target="#{listFilterPresetFrameModel.selectedListFilterPreset}"/>
										</p:commandLink>

										<p:commandLink action="#{listFilterPresetFrameModel.removeListFilterPreset()}"
													   title="#{overallBundle['box.overall.delete']}" styleClass="column width-25" update="apply_filter_list #{update}">
											<f:setPropertyActionListener value="#{preset}" target="#{listFilterPresetFrameModel.selectedListFilterPreset}"/>
											<i class="fa fa-trash icon-btn fs20"/>
											<p:confirm header="#{filterBundle['box.filter.preset.delete_dialog']}" message="#{filterBundle['box.filter.preset.delete_dialog.details']} #{preset.name}?"  />
										</p:commandLink>
									</div>
								</p:dataList>

							</p:overlayPanel>
						</p:outputPanel>
					</div>

					<div class="complete-block filter-list">

						<ui:insert name="completeFilterFields"/>

						<div class="m-tex-al-right m-mar-bot10">
							<p:commandButton id="find" styleClass="m-mar-right10" value="#{overallBundle['box.overall.search']}" icon="fa fs17 fa-search"
											 action="#{lazyDm.reloadData()}" update="#{resultFormId}"/>

							<p:commandButton styleClass="m-mar-right10 m-blue-text-button m-raised-button" process="@this"
											 value="#{overallBundle['box.overall.clear']}"
											 action="#{viewState.clearParamsJSF()}" update="#{filterFormId} #{resultFormId}">
								<p:ajax listener="#{lazyDm.reloadData()}"/>
								<f:setPropertyActionListener value="#{null}" target="#{listFilterPresetFrameModel.selectedListFilterPreset}"/>
							</p:commandButton>
						</div>
						<p:commandLink id="card_close" oncomplete="Argus.System.BlockToggler.toggleFilter($('##{update}-card_close'))" update="#{update}"
									   styleClass="card-toggler m-disp-block" title="#{overallBundle['box.overall.minimize']}">
							<i class="icon-ellipsis"/>
						</p:commandLink>
					</div>

					<div class="short-block m-disp-none">
						<div class="content">

							<h:outputText styleClass="m-disp-block" value="#{filterBundle['box.filter.preset.empty']}" rendered="#{viewState.filterMap.isEmpty()}"/>

							<ui:fragment rendered="#{!viewState.filterMap.isEmpty()}">
								<h:outputText styleClass="short-block-title" value="#{filterBundle['box.filter.param.plural']}:"/>
								<div class="short-block-list">

									<ui:insert name="shortFilterFields"/>
								</div>
							</ui:fragment>
							<p:commandLink id="card_open" onclick="Argus.System.BlockToggler.toggleFilter(this)"
										   styleClass="card-toggler" title="#{overallBundle['box.overall.maximize']}">
								<i class="icon-ellipsis"/>
							</p:commandLink>
						</div>
					</div>
				</h:form>
			</div>
		</div>
	</div>

	<div class="m-container100 m-responsive100">
		<div class="m-container-indent">
			<div class="m-card m-shadow-effect m-hei-auto-on-mobile simple-fb">
				<ui:insert name="searchResult"/>
			</div>
		</div>
	</div>

	<ui:include src="ListFilterPresetCreationDialog.xhtml">
		<ui:param name="update" value="#{update}"/>
	</ui:include>

</ui:composition>
