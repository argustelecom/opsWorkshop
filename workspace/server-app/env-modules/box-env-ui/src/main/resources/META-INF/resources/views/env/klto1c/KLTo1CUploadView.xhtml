<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
                xmlns:pm="http://primefaces.org/modena">

    <ui:param name="viewModel" value="#{klTo1cVM}" />
    <ui:param name="pageTitle" value="Загрузка данных из 1С" />

    <ui:define name="head">
        <h:outputStylesheet name="box-env/styles/box-env.css"/>
        <h:outputStylesheet name="inf/styles/box-functional-block.css"/>
    </ui:define>

    <ui:define name="pagePath">
        <p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml"/>
		<p:menuitem value="#{overallBundle['box.overall.dir.dashboard']}" url="/views/env/directory/DirectoryDashboardView.xhtml"/>
        <p:menuitem value="Импорт выгрузки из клиента банка"/>
    </ui:define>

    <ui:define name="body">
        <div class="m-container100 m-responsive100">
			<div class="m-container-indent">
				<div class="m-hei-auto-on-mobile">
					<h:form id="upload_form">

						<p:wizard flowListener="#{klTo1cVM.onFlowProcess}" backLabel="Предыдущий шаг" nextLabel="Следующий шаг" styleClass="kl-to-1c">

							<p:tab id="upload_step" title="Шаг 1. Загрузка">
								<div class="m-container100 m-responsive100">
									<div class="m-container-indent">
										<div class="m-card m-shadow-effect custom-content-card simple-fb">

											<div class="ui-dashboard-header">
												<i class="fa fa-file-o"/>
												<h:outputText styleClass="card-header" value="Загрузка файла для импорта"/>
											</div>

											<p:outputPanel id="upload_step_panel">
												<ui:fragment rendered="#{klTo1cVM.file eq null}">
													<p:fileUpload fileUploadListener="#{klTo1cVM.handleFileUpload}"
																  mode="advanced" label="Обзор ..." update="upload_form-upload_step_panel"
																  auto="true" sizeLimit="100000" allowTypes="/(\.|\/)txt$/" styleClass="m-pad-top10 kl-to-1c"
																  required="true"/>
												</ui:fragment>

												<p:outputPanel rendered="#{klTo1cVM.file ne null}" style="padding: 20px;">
													<h:outputText value="Файл загружен: #{klTo1cVM.file.fileName}"/>

													<p:commandLink action="#{klTo1cVM.removeFile()}" process="@this" update="upload_form-upload_step_panel">
														<i class="icon-cancel m-red fs24"></i>
													</p:commandLink>
												</p:outputPanel>
											</p:outputPanel>
										</div>
									</div>
								</div>
							</p:tab>

							<p:tab id="parse_step" title="Шаг 2. Просмотр">
								<div class="m-container100 m-responsive100">
									<div class="m-container-indent">
										<div class="m-card m-shadow-effect custom-content-card simple-fb">

											<div class="ui-dashboard-header">
												<i class="fa fa-list"/>
												<h:outputText styleClass="card-header" value="Просмотр результатов обработки файла"/>
											</div>

											<h3 style="padding: 20px">Общая информация</h3>

											<div class="columns">
												<div class="column width-30-percents" style="padding-left: 20px;">
													<dl class="name-value width-150">
														<dt>
															<p:outputLabel for="start_date" value="Начало интервала:"/>
														</dt>
														<dd>
															<p:inputText id="start_date" value="#{klTo1cVM.exportData.startDate}" disabled="true">
																<sysinf:convertDateTime pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"/>
															</p:inputText>
														</dd>

														<dt>
															<p:outputLabel for="end_date" value="Конец интервала:"/>
														</dt>
														<dd>
															<p:inputText id="end_date" value="#{klTo1cVM.exportData.endDate}" disabled="true">
																<sysinf:convertDateTime pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"/>
															</p:inputText>
														</dd>
													</dl>
												</div>

												<div class="column width-70-percents" style="padding-right: 20px;">
													<p:dataTable value="#{klTo1cVM.checkingAccounts}" var="account">
														<p:column headerText="Расчётные счета">
															#{account}
														</p:column>

														<p:column headerText="Тип документа">
															Платёжное поручение
														</p:column>

														<p:column headerText="Количество">
															#{klTo1cVM.checkingAccountCountMap.get(account)}
														</p:column>
													</p:dataTable>
												</div>
											</div>
										</div>
									</div>
								</div>
							</p:tab>

						</p:wizard>

					</h:form>
				</div>
			</div>
        </div>
    </ui:define>

</ui:composition>