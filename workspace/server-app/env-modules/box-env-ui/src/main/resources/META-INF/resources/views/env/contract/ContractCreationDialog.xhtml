<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:pm="http://primefaces.org/modena" xmlns:f="http://java.sun.com/jsf/core">

	<f:loadBundle var="overallBundle" basename="OverallBundle"/>
	<f:loadBundle var="contractBundle" basename="ContractBundle"/>
	<f:loadBundle var="documentTypeBundle" basename="DocumentTypeBundle"/>

	<h:form id="contract_creation_form">
		<p:dialog id="contract_creation_dlg" header="#{contractBundle['box.contract.overall.create_dialog.name']}" width="650" styleClass="icon-creation"
				  widgetVar="contractCreationDlgVar" resizable="false" modal="true" closable="false" dynamic="true">
			<p:outputPanel id="contract_creation_params">
				<dl class="name-value width-150">
					<dt>
						<p:outputLabel for="contract_type" value="#{overallBundle['box.overall.type']}:"/>
					</dt>
					<dd>
						<p:selectOneMenu id="contract_type" value="#{contractCreationDialogModel.newType}" required="true"
							 	label="#{overallBundle['box.overall.type']}">

							<p:ajax process="@this" update="contract_creation_params" listener="#{contractCreationDialogModel.onContractTypeChanged()}"/>

							<f:selectItem itemValue=""/>
							<f:selectItems  value="#{contractCreationDialogModel.types}" var="type" itemLabel="#{type.objectName}"
									itemValue="#{type}"/>
						</p:selectOneMenu>
					</dd>
					<dt>
						<p:outputLabel for="customer" value="#{contractBundle['box.contract.customer']}:"/>
					</dt>
					<dd>
						<p:autoComplete id="customer" value="#{contractCreationDialogModel.newCustomer}" var="customer"
										itemValue="#{customer}" itemLabel="#{customer.objectName}" styleClass="width-100-percents"
										disabled="#{!canSelectCustomer or contractCreationDialogModel.newType eq null}" required="true"
										completeMethod="#{contractCreationDialogModel.completeCustomer}"
										label="#{contractBundle['box.contract.customer']}"/>
					</dd>

					<dt>
						<p:outputLabel for="valid_from" value="#{overallBundle['box.overall.valid_from']}:"/>
					</dt>
					<dd>
						<p:calendar id="valid_from" value="#{contractCreationDialogModel.newValidFrom}" required="true"
									pattern="#{dateUtils.DATE_DEFAULT_PATTERN}" styleClass="width-40-percents"
									locale="#{languageBean.locale.language}" label="#{overallBundle['box.overall.valid_from']}">
							<p:ajax event="dateSelect" process="@this" update="valid_to"/>
						</p:calendar>

						<p:outputLabel for="valid_to" value="#{overallBundle['box.overall.valid_to.short']}:"
								   	styleClass="m-tex-al-right width-17-percents"/>
						<p:calendar id="valid_to" value="#{contractCreationDialogModel.newValidTo}" pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"
									styleClass="width-40-percents"
									mindate="#{contractCreationDialogModel.newValidFrom}" locale="#{languageBean.locale.language}"/>
					</dd>
					<dt>
						<p:outputLabel for="provider" value="#{documentTypeBundle['box.doc.type.contract.provider']}:" />
					</dt>
					<dd>
						<h:outputText id="provider" styleClass="m-mar-left-8" value="#{contractCreationDialogModel.newType.provider.objectName}"/>
					</dd>

					<o:importConstants type="ru.argustelecom.box.env.contract.model.ContractCategory" var="contractCategory" />
					<ui:fragment rendered="#{contractCreationDialogModel.newType.contractCategory eq contractCategory.AGENCY}">
						<dt>
							<p:outputLabel for="broker" value="#{contractBundle['box.contract.broker']}:" />
						</dt>
						<dd>
							<p:selectOneMenu id="broker" value="#{contractCreationDialogModel.newBroker}" required="true">
								<f:selectItems value="#{contractCreationDialogModel.possibleBrokers}" var="broker"
									itemLabel="#{broker.name}" itemValue="#{broker}" />
							</p:selectOneMenu>
						</dd>
					</ui:fragment>

					<o:importConstants type="ru.argustelecom.box.env.contract.model.PaymentCondition" var="paymentCondition"/>

					<dt>
						<p:outputLabel for="payment_condition" value="#{contractBundle['box.contract.payment_condition']}:"/>
					</dt>
					<dd>
						<p:selectOneMenu id="payment_condition" value="#{contractCreationDialogModel.newPaymentCondition}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{paymentCondition.values()}" var="pc" itemLabel="#{pc.getName()}" itemValue="#{pc}"/>
						</p:selectOneMenu>
					</dd>

					<dt>
						<p:outputLabel for="number" value="#{contractBundle['box.contract.number']}:"/>
					</dt>
					<dd>
						<p:inputText id="number" value="#{contractCreationDialogModel.newNumber}"
								 	styleClass="width-100-percents"
								 	placeholder="#{overallBundle['box.overall.numeration.hint']}"/>
					</dd>
				</dl>
			</p:outputPanel>

			<ui:fragment rendered="#{not empty contractCreationDialogModel.order.unmodifiableOffers}">
				<ui:include src="/views/env/order/OrderOffersForContractFrame.xhtml">
					<ui:param name="abstractContractCreationDialogMolde" value="#{contractCreationDialogModel}"/>
				</ui:include>
			</ui:fragment>

			<div class="dialog-footer-buttons">
				<p:commandButton id="cancel_button" value="#{overallBundle['box.overall.cancel']}"
								 styleClass="m-blue-text-button" update="contract_creation_dlg"
								 process="@this" action="#{contractCreationDialogModel.cleanCreationParams()}"
								 onclick="PF('contractCreationDlgVar').hide()"/>
				<p:commandButton id="create_button" value="#{overallBundle['box.overall.create']}"

								 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('contractCreationDlgVar').hide()}"
								 action="#{contractCreationDialogModel.onCreated()}" process="contract_creation_dlg" update="#{update}"/>
			</div>

		</p:dialog>
	</h:form>

</ui:composition>
