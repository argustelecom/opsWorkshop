<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
	xmlns:sysinf="http://argustelecom.ru/system-inf" xmlns:pm="http://primefaces.org/modena">

	<ui:param name="viewModel" value="#{commodityTypeDirectoryVm}" />
	<ui:param name="pageTitle" value="#{lookupBundle['box.lookup.dir.plural']}" />

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="lookupCategory" value="#{currentLookupCategory.value}" required="false" />
		</f:metadata>
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet name="box-env/styles/box-env.css" />
		<h:outputStylesheet name="inf/styles/box-functional-block.css" />
	</ui:define>

	<ui:define name="pagePath">
		<f:loadBundle basename="OverallBundle" var="overallBundle" />
		<f:loadBundle basename="LookupBundle" var="lookupBundle" />

		<p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml" />
		<p:menuitem value="#{overallBundle['box.overall.dir.dashboard']}"
			url="/views/env/directory/DirectoryDashboardView.xhtml" />
		<p:menuitem value="#{lookupBundle['box.lookup.dir.plural']}"
			url="/views/env/type/LookupDirectoryView.xhtml" />
	</ui:define>

	<ui:define name="body">
		<div class="m-container35 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<h:form id="lookup_category_form">
							<div class="ui-dashboard-header">
								<p:inputText styleClass="m-wid50 m-wid-auto-on-mobile m-mar-right10" disabled="true" />
								<i class="fa fa-search" />

								<p:outputPanel id="managed_buttons" styleClass="m-fright">
									<p:commandLink id="create_category_button" styleClass="m-mar-left10"
													update="lookup_category_form" title="#{overallBundle['box.overall.create']}"
													onclick="PF('lookupCategoryCreateDlgVar').show()"
													disabled="#{!p:ifGranted('System_LookupDirectoryEdit')}">
													<i class="fa fa-edit icon-btn"/>
									</p:commandLink>
									<p:commandLink styleClass="m-mar-left10" action="#{lookupDirectoryViewModel.removeSelectedTypes()}" process="@this"
													disabled="#{!p:ifGranted('System_LookupDirectoryEdit') or empty lookupDirectoryViewModel.selectedTypes}" update="lookup_category_form"
													title="#{overallBundle['box.overall.delete']}">
													<i class="fa fa-trash icon-btn"/>
													<p:confirm header="#{lookupBundle['box.lookup.category.delete_dialog']}"
																message="#{lookupBundle['box.lookup.category.delete_dialog.details']}" />
									</p:commandLink>
								</p:outputPanel>
							</div>
							
							<p:outputPanel id="navigation_panel">
								<p:dataTable id="categories" value="#{lookupDirectoryViewModel.types}" var="category"
										selection="#{lookupDirectoryViewModel.selectedTypes}" rowKey="#{category.id}" 
										editable="true" styleClass="m-ov-auto">
										
									<p:ajax event="rowSelectCheckbox" update="lookup_category_form-managed_buttons"/>
									<p:ajax event="rowUnselectCheckbox" update="lookup_category_form-managed_buttons"/>
									<p:ajax event="rowSelect" update="lookup_category_form-managed_buttons"/>
									<p:ajax event="rowUnselect" update="lookup_category_form-managed_buttons"/>
									<p:ajax event="toggleSelect" update="lookup_category_form-managed_buttons"/>
									
									<p:column selectionMode="multiple" styleClass="width-16 m-tex-al-center" />	

									<p:column headerText="#{lookupBundle['box.lookup.category']}">
										<p:cellEditor>
               								<f:facet name="output"><h:outputText value="#{category.objectName}" /></f:facet>
               								<f:facet name="input">
               									<p:inputText value="#{category.objectName}" />
               								</f:facet>
           								</p:cellEditor>
									</p:column>

									<p:column headerText="#{overallBundle['box.overall.desc']}">
										<p:cellEditor>
               								<f:facet name="output"><h:outputText value="#{category.description}" /></f:facet>
               								<f:facet name="input">
               									<p:inputText value="#{category.description}" />
               								</f:facet>
           								</p:cellEditor>
									</p:column>
									
									<p:column styleClass="width-32" rendered="#{p:ifGranted('System_LookupDirectoryEdit')}">
										<p:rowEditor editTitle="#{overallBundle['box.overall.edit']}"/>
									</p:column>
								</p:dataTable>

								<script>
									$( document ).ready(function() {
										Argus.System.AutoHeight.compute('lookup_category_form', 50);
										Argus.System.AutoHeight.compute('lookup_category_form-categories', 50);
									});
								</script>
							</p:outputPanel>
						</h:form>
					</div>
				</div>
			</div>
		</div>

		<!-- Информация по выбранному объекту -->
		<div class="m-container65 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<ui:include src="/views/env/type/LookupEntriesFrame.xhtml"/>
					</div>
				</div>
			</div>
		</div>
	</ui:define>

	<ui:define name="dialogs">
		<ui:include src="LookupCategoryCreationDialog.xhtml">
			<ui:param name="updatedElements" value="lookup_category_form entries_form" />
		</ui:include>

		<ui:include src="LookupEntryCreationDialog.xhtml">
			<ui:param name="updatedElements" value="entries_form" />
		</ui:include>
	</ui:define>
</ui:composition>