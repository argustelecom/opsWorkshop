<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:pm="http://primefaces.org/modena" xmlns:f="http://java.sun.com/jsf/core">

	<f:loadBundle var="pricelistBundle" basename="PricelistBundle"/>
	<h:form id="pricelist_creation_form">
		<p:dialog id="pricelist_creation_dlg" header="#{pricelistBundle['box.pricelist.create_dialog']}"
				  width="550" styleClass="icon-creation"
				  widgetVar="pricelistCreationDlgVar" resizable="false" modal="true" closable="false" dynamic="true">

			<dl class="name-value width-150">
				<dt>
					<p:outputLabel for="new_name" value="#{overallBundle['box.overall.name']}:"/>
				</dt>
				<dd>
					<p:inputText id="new_name" value="#{pricelistCreationDialogModel.pricelistCreationDto.name}"  maxlength="128"
								 required="true" label="#{overallBundle['box.overall.name']}"/>
				</dd>

				<dt>
					<p:outputLabel for="new_valid_from" value="#{overallBundle['box.overall.valid_from']}"/>
				</dt>
				<dd>
					<p:calendar id="new_valid_from" value="#{pricelistCreationDialogModel.pricelistCreationDto.validFrom}"
								pattern="#{dateUtils.DATE_DEFAULT_PATTERN}" styleClass="width-40-percents"
								required="true" locale="#{languageBean.locale.language}"
								label="#{overallBundle['box.overall.valid_from']}">
						<p:ajax event="dateSelect" process="@this" update="pricelist_creation_form-valid_to"/>
					</p:calendar>

					<p:outputLabel for="valid_to" value="#{overallBundle['box.overall.valid_to.short']}:"
								   styleClass="m-tex-al-right width-17-percents"/>
					<p:calendar id="valid_to" value="#{pricelistCreationDialogModel.pricelistCreationDto.validTo}" mindate="#{pricelistCreationDialogModel.pricelistCreationDto.validFrom}"
								pattern="#{dateUtils.DATE_DEFAULT_PATTERN}" styleClass="width-40-percents"
								locale="#{languageBean.locale.language}"
								label="#{overallBundle['box.overall.valid_to.short']}"/>
				</dd>

                <ui:fragment rendered="#{pricelistCreationDialogModel.renderOwner}">
				<dt>
					<p:outputLabel for="owners" value="#{pricelistBundle['box.pricelist.owner']}:"/>
				</dt>
				<dd>
					<p:selectOneMenu id="owners" label="#{pricelistBundle['box.pricelist.owner']}"
										  value="#{pricelistCreationDialogModel.pricelistCreationDto.owner}"
										  filter="true" filterMatchMode="startsWith" styleClass="width-92-percents"
										  converter="persistentIdentifiableConverter">
						<f:selectItems value="#{pricelistCreationDialogModel.owners}" var="owner" itemValue="#{owner}"
									   itemLabel="#{owner.objectName}"/>
					</p:selectOneMenu>
				</dd>
                </ui:fragment>

				<ui:fragment rendered="#{pricelistCreationDialogModel.mode eq 'COMMON'}">
					<dt>
						<p:outputLabel value="#{pricelistBundle['box.pricelist.customer.segments']}:"/>
					</dt>
					<dd>
						<p:selectCheckboxMenu id="customer_segments" label="#{pricelistBundle['box.pricelist.customer.segments']}"
											  value="#{pricelistCreationDialogModel.pricelistCreationDto.segments}"
											  filter="true" filterMatchMode="startsWith" styleClass="width-92-percents"
											  converter="persistentIdentifiableConverter">
							<f:selectItems value="#{pricelistCreationDialogModel.segments}" var="segment" itemValue="#{segment}"
										   itemLabel="#{segment.objectName}"/>
						</p:selectCheckboxMenu>
					</dd>
				</ui:fragment>

				<ui:fragment rendered="#{pricelistCreationDialogModel.mode eq 'CUSTOM'}">
					<dt>
						<p:outputLabel for="new_customer_type" value="#{pricelistBundle['box.pricelist.customer.type']}:"/>
					</dt>
					<dd>
						<p:selectOneMenu id="new_customer_type" required="true" value="#{pricelistCreationDialogModel.pricelistCreationDto.customerType}"
										 label="#{pricelistBundle['box.pricelist.customer.type']}"
										 converter="persistentIdentifiableConverter">

							<p:ajax process="@this" update="pricelist_creation_form-new_customer"/>

							<f:selectItem itemValue="#{null}"/>
							<f:selectItems value="#{pricelistCreationDialogModel.customerTypes}" var="customerType"
										   itemLabel="#{customerType.objectName}" itemValue="#{customerType}"/>
						</p:selectOneMenu>
					</dd>

					<dt>
						<p:outputLabel for="new_customer" value="#{pricelistBundle['box.pricelist.customer']}:"/>
					</dt>
					<dd>
						<p:autoComplete id="new_customer" value="#{pricelistCreationDialogModel.pricelistCreationDto.customer}" var="customer"
										itemValue="#{customer}" itemLabel="#{customer.objectName}" styleClass="width-100-percents"
										disabled="#{pricelistCreationDialogModel.pricelistCreationDto.customerType eq null}"
										completeMethod="#{pricelistCreationDialogModel.completeCustomer}" required="true"
										label="#{pricelistBundle['box.pricelist.customer']}"/>
					</dd>
				</ui:fragment>
			</dl>

			<div class="dialog-footer-buttons">
				<p:commandButton id="cancel_button" value="#{overallBundle['box.overall.cancel']}"
								 styleClass="m-blue-text-button" update="#{update} pricelist_creation_dlg" resetValues="true" immediate="true"
								 process="@this" action="#{pricelistCreationDialogModel.cleanCreationParams()}" onclick="PF('pricelistCreationDlgVar').hide()"/>

				<p:commandButton id="create_button" value="#{overallBundle['box.overall.create']}"
								 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('pricelistCreationDlgVar').hide()}"
								 action="#{pricelistCreationDialogModel.onCreated()}" update="new_name new_valid_from valid_to owners" process="pricelist_creation_dlg"/>
			</div>

		</p:dialog>
	</h:form>

</ui:composition>
