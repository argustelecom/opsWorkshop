<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui">

	<ui:param name="viewModel" value="#{resourceVM}"/>
	<ui:param name="pageTitle" value="#{resourceBundle['box.nri.resource.tree_header']}"/>

	<ui:define name="metadata">
		<f:metadata>
			<f:viewParam name="resource" value="#{resourceViewState.resource}"/>
		</f:metadata>
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet name="resources/box-env/styles/box-env.css"/>
		<h:outputStylesheet name="resources/inf/styles/box-functional-block.css"/>
		<h:outputStylesheet name="resources/nri/styles/nri.css"/>
	</ui:define>

	<ui:define name="pagePath">
		<f:loadBundle basename="OverallBundle" var="overallBundle"/>
		<f:loadBundle basename="ResourceBundle" var="resourceBundle"/>
		<f:loadBundle basename="ResourcesBundle" var="resourcesBundle"/>
		<f:loadBundle basename="PhoneNumberPoolBundle" var="phoneNumberPoolBundle"/>

		<p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml"/>
		<p:menuitem value="#{resourcesBundle['box.nri.resources.resources_header']}" url="ResourcesView.xhtml"/>
		<p:menuitem value="#{resourceBundle['box.nri.resource.tree_header']}"/>
	</ui:define>

	<ui:define name="body">
		<div class="m-container35 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">

						<h:form id="resource_structure_tree_form">
							<div class="ui-dashboard-header">
								#{resourceBundle['box.nri.resource.tree_header']}
								<p:outputPanel id="tree_buttons_panel" styleClass="m-fright">
									<p:commandLink id="create_resource_button" styleClass="m-mar-left10"
												   update="-resource_specification_selection_dlg"
												   rendered="#{resourceVM.selectedResource ne null and
														not empty resourceVM.selectedResource.specification.childSpecifications and p:ifGranted('Nri_ResourceInfoEdit')}"
												   oncomplete="PF('resourceSpecificationSelectDlg').show()">
										<i class="fa fa-plus icon-btn"/>
										<f:setPropertyActionListener value="#{resourceVM.createResource}"
																	 target="#{createResourceInfoFrameModel.onSaveButtonPressed}"/>
									</p:commandLink>
									<p:commandLink id="remove_button" styleClass="m-mar-left10"
												   update="tree_buttons_panel building_elem_tree_panel resource_info_form logical_resources_form
															resource_isntallation_info_form"
												   action="#{resourceVM.removeSelectedResource}"
												   rendered="#{p:ifGranted('Nri_ResourceInfoEdit')
																and resourceVM.selectedNode ne null and resourceVM.removableResource}">
										<i class="fa fa-trash icon-btn"/>

										<p:confirm header="#{resourceBundle['box.nri.resource.remove_header']}"
												   message="#{resourceBundle['box.nri.resource.remove_message']}"/>
									</p:commandLink>
								</p:outputPanel>
							</div>

							<p:outputPanel id="building_elem_tree_panel" styleClass="fs14">
								<p:tree id="resource_structure_tree" value="#{resourceVM.elementsTree}" var="node"
										styleClass="width-100-percents m-ov-auto tree-no-border" selectionMode="single"
										selection="#{resourceVM.selectedNode}" style="overflow-x: hidden"
										propagateSelectionDown="false" propagateSelectionUp="false">

									<p:ajax event="select" process="@this" listener="#{resourceVM.onNodeSelect}"
											update="-resource_info_form resource_structure_tree_form-tree_buttons_panel
													-resource_isntallation_info_form
													-resource_lifecycle_form
													-ports_info_form
													-resource_specification_selection_form
				                                    -logical_resources_form"/>

									<p:treeNode>
										<h:outputText value="#{node.name}" style="padding-left: 5px;"/>
									</p:treeNode>

								</p:tree>
							</p:outputPanel>
						</h:form>

						<script>
                            $(document).ready(function () {
                                Argus.System.AutoHeight.compute('resource_structure_tree_form', 40);
                                Argus.System.AutoHeight.compute('resource_structure_tree_form-resource_structure_tree', 35);
                            });
						</script>

					</div>
				</div>
			</div>
		</div>

		<div class="m-container65 m-responsive100">
			<h:form id="resource_info_form">
				<p:outputPanel id="resource_info_panel" styleClass="m-container100"
							   rendered="#{resourceVM.selectedResource ne null}">
					<ui:include src="ResourceInfoFrame.xhtml">
						<ui:param name="resourceInstance" value="#{resourceVM.selectedResource}"/>
					</ui:include>
				</p:outputPanel>
			</h:form>
		</div>
		<div class="m-container65 m-responsive100">
			<h:form id="resource_lifecycle_form">
				<ui:include src="lifecycle/ResourceLifecycleFrame.xhtml">
					<ui:param name="resource" value="#{resourceVM.selectedResource}"/>
				</ui:include>
			</h:form>
		</div>
		<div class="m-container65 m-responsive100">
			<h:form id="resource_isntallation_info_form">
				<p:outputPanel id="resource_isntallation_info_panel" styleClass="m-container100"
							   rendered="#{resourceVM.selectedResource ne null}">
					<ui:include src="ResourceInstallationInfoFrame.xhtml">
						<!--<ui:param name="update" value="resource_isntallation_info_form"/>-->
						<ui:param name="resourceInstance" value="#{resourceVM.selectedResource}"/>
					</ui:include>
				</p:outputPanel>
			</h:form>
		</div>
		<div class="m-container65 m-responsive100">
			<h:form id="ports_info_form">
				<p:outputPanel id="ports_info_panel" styleClass="m-container100"
							   rendered="#{not empty resourceVM.selectedResource.specification.supportedPortTypes}">
					<ui:include src="ResourcePortsInfoFrame.xhtml">
						<!--<ui:param name="update" value="resource_isntallation_info_form"/>-->
						<ui:param name="resourceInstance" value="#{resourceVM.selectedResource}"/>
					</ui:include>
				</p:outputPanel>
			</h:form>
		</div>
		<div class="m-container65 m-responsive100">
			<h:form id="logical_resources_form">
				<p:outputPanel id="logical_resources" styleClass="m-container100"
							   rendered="#{resourceVM.resourceCanContainLogicalResources()}">
					<ui:include src="LogicalResourcesFrame.xhtml">
						<ui:param name="resourceInstance" value="#{resourceVM.selectedResource}"/>
					</ui:include>
				</p:outputPanel>
			</h:form>
		</div>
	</ui:define>

	<ui:define name="dialogs">
		<p:dialog id="resource_specification_selection_dlg"
				  header="#{resourceBundle['box.nri.resource.resource_creation']}"
				  widgetVar="resourceSpecificationSelectDlg" resizable="false" modal="true" closable="false"
				  styleClass="icon-creation" style="max-width: 75%; min-width: 50%;">
			<h:form id="resource_specification_selection_form">

				<p:outputPanel id="new_resource_spec_panel" style="width: 100%"
							   rendered="#{resourceVM.newElemSpecificationId eq null}">
					<dl class="name-value width-250">
						<dt>
							<p:outputLabel for="new_spec" value="#{resourceBundle['box.nri.resource.new_spec']}"/>
						</dt>
						<dd>
							<p:selectOneMenu value="#{resourceVM.newElemSpecificationId}"
											 id="new_spec" required="true">
								<p:ajax event="change" update="@form" process="@this"
										oncomplete="PF('resourceSpecificationSelectDlg').initPosition()"/>
								<f:selectItem value="#{null}"/>
								<f:selectItems value="#{resourceVM.selectedResource.specification.childSpecifications}"
											   var="spec" itemLabel="#{spec.name}" itemValue="#{spec.id}"/>
							</p:selectOneMenu>
						</dd>
					</dl>
				</p:outputPanel>

				<p:outputPanel id="new_resource_param_panel"
							   rendered="#{resourceVM.newElemSpecificationId ne null}">
					<ui:include src="CreateResourceInfoFrame.xhtml">
						<ui:param name="parentResource" value="#{resourceVM.selectedResource}"/>
						<ui:param name="specificationId" value="#{resourceVM.newElemSpecificationId}"/>
					</ui:include>
				</p:outputPanel>

				<div class="dialog-footer-buttons">
					<p:commandButton id="cancel_creation_button"
									 value="#{overallBundle['box.overall.cancel']}"
									 styleClass="m-blue-text-button" immediate="true"
									 update="resource_specification_selection_dlg" resetValues="true"
									 action="#{resourceVM.cleanCreationParams()}"
									 onclick="PF('resourceSpecificationSelectDlg').hide()"/>
					<p:commandButton id="dialog_create_button"
									 value="#{overallBundle['box.overall.create']}"
									 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('resourceSpecificationSelectDlg').hide(); cleanCreationParams();}"
									 actionListener="#{createResourceInfoFrameModel.createResource()}"
									 update="new_spec -resource_info_form -resource_isntallation_info_form resource_structure_tree_form-tree_buttons_panel
									  -resource_structure_tree_form-building_elem_tree_panel logical_resources_form resource_lifecycle_form"/>
				</div>
				<p:remoteCommand name="cleanCreationParams" actionListener="#{resourceVM.cleanCreationParams()}"/>
			</h:form>
		</p:dialog>

		<p:dialog id="installation_creation_dlg"
				  header="#{resourceBundle['box.nri.resource.installation_title']}" closeOnEscape="true"
				  widgetVar="installationCreationDlg" resizable="false" modal="true" closable="false"
				  styleClass="icon-creation" style="max-width: 75%; min-width: 50%;">

			<h:form id="installation_creation_form">

				<p:outputPanel id="new_installation_dlg_panel" style="width: 100%">
					<dl class="name-value width-250">
						<dt>
							<p:outputLabel for="new_intallation_address"
										   value="#{resourcesBundle['box.nri.resources.location']}:"/>
						</dt>
						<dd>
							<p:autoComplete id="new_intallation_address"
											value="#{resourceInstallationInfoFM.selectedBuildingElementDto}"
											completeMethod="#{resourceInstallationInfoFM.completeLocation}"
											valueChangeListener="#{resourceInstallationInfoFM.selectLocation}"
											var="buildingElement" effect="blind"
											itemLabel="#{resourceInstallationInfoFM.getName(buildingElement.getLocation())}"
											itemValue="#{buildingElement}" autoHighlight="false" forceSelection="true"
											minQueryLength="2" queryEvent="keyup" queryDelay="500" maxlength="1000">
								<f:converter converterId="nriDtoConverter"/>
								<p:ajax event="itemSelect" update="@form"
										listener="#{resourceInstallationInfoFM.selectLocation}"/>
							</p:autoComplete>
						</dd>
					</dl>
				</p:outputPanel>

				<div class="dialog-footer-buttons">
					<p:commandButton id="cancel_installation_creation_button"
									 value="#{overallBundle['box.overall.cancel']}"
									 styleClass="m-blue-text-button" immediate="true"
									 update="@form"
									 actionListener="#{resourceInstallationInfoFM.cleanCreationParams()}"
									 onclick="PF('installationCreationDlg').hide()"/>
					<p:commandButton id="installation_create_button"
									 disabled="#{resourceInstallationInfoFM.selectedBuildingElementDto eq null}"
									 value="#{overallBundle['box.overall.create']}" resetValues="true"
									 update="resource_isntallation_info_form @form"
									 actionListener="#{resourceInstallationInfoFM.createNewInstallation()}"
									 oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('installationCreationDlg').hide()}"/>
				</div>
			</h:form>

		</p:dialog>
		<ui:include src="ResourceView_AddPhoneNumberDialog.xhtml"/>

		<ui:include src="ports/AddPortDialog.xhtml">
			<ui:param name="resourceInstance" value="#{resourceVM.selectedResource}"/>
			<ui:param name="updateWhenCancel" value="-ports_info_form-possible_ports_type -ports_info_form"/>
			<ui:param name="update" value="-ports_info_form -ports_info_form-possible_ports_type"/>
			<ui:param name="req" value="false"/>
		</ui:include>
	</ui:define>

</ui:composition>
