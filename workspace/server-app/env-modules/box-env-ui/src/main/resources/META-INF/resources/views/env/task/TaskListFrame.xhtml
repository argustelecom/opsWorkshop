<ui:composition template="/views/env/filter/ListFrame.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
                xmlns:boxenv="http://argustelecom.ru/box/env">

    <ui:define name="completeFilterFields">
        <ul>
            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="task_number" value="#{overallBundle['box.overall.name']}:" styleClass="width-100"/>
					</span>
					<span class="filter-value">
						<p:inputText id="task_number" value="#{taskListViewState.number}"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="task_type" value="#{taskBundle['box.task.type']}:" styleClass="width-100"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="task_type" value="#{taskListViewState.taskType}"
										 process="@this">

							<p:ajax process="@this" update="#{filterFormId}"/>

							<f:selectItem itemValue=""/>
							<f:selectItems value="#{taskListViewModel.taskTypes}" var="taskType"
										   itemLabel="#{taskType.name}" itemValue="#{taskType}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="create_from" value="#{taskBundle['box.task.search.created_from']}:" styleClass="width-120"/>
					</span>
					<span class="filter-value">
						<p:calendar id="create_from" value="#{taskListViewState.createdFrom}"
									pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}"
									styleClass="width-43-percents" locale="#{languageBean.locale.language}"/>

						<p:outputLabel for="create_to" value="#{taskBundle['box.task.search.created_to']}:"
									   styleClass="m-tex-al-right width-10-percents mar-top-2"/>
						<p:calendar id="create_to" value="#{taskListViewState.createdTo}"
									pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}"
									styleClass="width-43-percents" locale="#{languageBean.locale.language}"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="task_assignee" value="#{taskBundle['box.task.assignee']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="task_assignee" value="#{taskListViewState.assignee}"
										 converter="omnifaces.SelectItemsConverter"
										 process="@this"
										 var="assignee">

							<p:ajax process="@this"/>

							<f:selectItem itemValue="#{null}" itemLabel=""/>
							<f:selectItems value="#{taskListViewModel.assignees}"/>


							<p:column>
								<h:outputText
										styleClass="#{assignee['class'].simpleName eq 'RoleDto' ? 'm-font-bold' : ''}"
										value="#{assignee.name}"/>
							</p:column>
						</p:selectOneMenu>
					</span>
				</div>
			</li>
        </ul>
    </ui:define>

    <ui:define name="shortFilterFields">
        <ul>
            <ui:fragment rendered="#{taskListViewState.number ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.number']}:"/>
					<h:outputText value="#{taskListViewState.number};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{taskListViewState.taskType.name ne null}">
				<li>
					<p:outputLabel value="#{taskBundle['box.task.type']}:"/>
					<h:outputText value="#{taskListViewState.taskType.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{taskListViewState.createdFrom ne null}">
				<li>
					<p:outputLabel value="#{taskBundle['box.task.search.created_from']}:"/>
					<h:outputText value="#{dateUtils.format(taskListViewState.createdFrom, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{taskListViewState.createdTo ne null}">
				<li>
					<p:outputLabel value="#{taskBundle['box.task.search.created_to']}:"/>
					<h:outputText value="#{dateUtils.format(taskListViewState.createdTo, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{taskListViewState.assignee.name ne null}">
				<li>
					<p:outputLabel for="contract_short" value="#{taskBundle['box.task.assignee']}:"/>
					<h:outputText id="contract_short" value="#{taskListViewState.assignee.name};"/>
				</li>
			</ui:fragment>
		</ul>
    </ui:define>

    <ui:define name="searchResult">
        <h:form id="#{resultFormId}">

            <div class="ui-dashboard-header">
                <i class="fa fa-binoculars"/>
                <h:outputText styleClass="card-header"
                              value="#{overallBundle['box.overall.searching_results']}"/>
                <p:outputPanel id="managed_buttons" styleClass="m-fright">
                	<p:commandLink styleClass="m-disp-inl-block m-fright m-bold-gray m-mar-left10"
                                   update="assignee_selection_dlg" title="#{taskBundle['box.task.assign']}"
                                   oncomplete="PF('assigneeSelectionDlgVar').show()"
                                   disabled="#{!p:ifGranted('System_TaskListAssignPerformer') or not taskListViewModel.canAssign()}">
                        <f:setPropertyActionListener value="#{taskListViewModel.selectedTasks}" target="#{taskAssigneeDialogModel.selectedTasks}"/>
                        <f:setPropertyActionListener value="#{taskListViewModel.assignCallback}" target="#{taskAssigneeDialogModel.callback}"/>
                        <i class="fa fa-share-square-o icon-btn"/>
                    </p:commandLink>
                </p:outputPanel>
            </div>

            <p:dataTable id="task_table" value="#{taskListViewModel.lazyDm}" lazy="true" var="task" tableStyle="table-layout: fixed"
                         paginator="true" rows="25" emptyMessage="#{overallBundle['box.overall.empty']}"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}" rowsPerPageTemplate="25,50,100" sortMode="single"
                         sortBy="#{TaskSort.createDateTime}" sortOrder="ascending" selection="#{taskListViewModel.selectedTasks}">

				<p:ajax event="rowSelectCheckbox" update="#{resultFormId}-managed_buttons" />
				<p:ajax event="rowUnselectCheckbox" update="#{resultFormId}-managed_buttons" />
				<p:ajax event="rowSelect" update="#{resultFormId}-managed_buttons" />
				<p:ajax event="rowUnselect" update="#{resultFormId}-managed_buttons" />
				<p:ajax event="toggleSelect" update="#{resultFormId}-managed_buttons" />

				<p:column selectionMode="multiple" styleClass="width-16 m-tex-al-center"/>

                <p:column headerText="#{overallBundle['box.overall.number']}" sortBy="#{TaskSort.number}">
                	<boxenv:linkToCard value="#{task.getIdentifiable()}" text="#{task.number}"/>
                </p:column>

                <p:column headerText="#{taskBundle['box.task.type']}" sortBy="#{TaskSort.taskType}">
                    <h:outputText value="#{task.taskType.name}"/>
                </p:column>

                <p:column headerText="#{taskBundle['box.task.result.info']}">
                    <h:outputText styleClass="m-disp-block"
                                  value="#{taskBundle['box.task.customer']}: #{task.taskInfoDto.customer};"/>
                    <h:outputText styleClass="m-disp-block"
                                  value="#{taskBundle['box.task.personal_account']}: #{task.taskInfoDto.personalAccountNumber};"/>
                    <h:outputText styleClass="m-disp-block"
                                  value="#{taskBundle['box.task.product']}: #{task.taskInfoDto.product};"/>
                    <h:outputText styleClass="m-disp-block"
                                  value="#{taskBundle['box.task.address']}: #{taskListViewModel.formatAddresses(task)};"/>
                </p:column>

                <p:column headerText="#{taskBundle['box.task.created']}" sortBy="#{TaskSort.createDateTime}">
                    <h:outputText value="#{task.createDateTime}">
                        <sysinf:convertDateTime pattern="#{dateUtils.DATETIME_DEFAULT_PATTERN}"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="#{taskBundle['box.task.assignee']}" sortBy="#{TaskSort.assignee}">
                    <h:outputText rendered="#{task.assignee ne null}" value="#{task.assignee.name}"
                                  styleClass="m-disp-inl-block"/>
                    <h:outputText rendered="#{task.assignee eq null}" value="#{task.role.name}"
                                  styleClass="m-disp-inl-block"/>
                </p:column>

                <p:column styleClass="width-25">
                    <p:commandLink update="lifecycle_dlg" title="#{taskBundle['box.task.result.complete']}" styleClass="m-bold-gray"
                                   oncomplete="PF('lifecycleDlgVar').show();"
                                   disabled="#{!p:ifAnyGranted('System_TaskPerform') or !taskListViewModel.canResolve(task)}">
                        <f:setPropertyActionListener value="#{task}" target="#{taskLifecycleDialogModel.selectedTask}"/>
                        <f:setPropertyActionListener value="#{taskListViewModel.resolveCallback}" target="#{taskLifecycleDialogModel.callback}"/>
                        <i class="icon-assignment_turned_in fs20"/>
                    </p:commandLink>
                </p:column>

            </p:dataTable>
        </h:form>
    </ui:define>

</ui:composition>