<ui:composition template="/views/env/filter/ListFrame.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
                xmlns:boxenv="http://argustelecom.ru/box/env">

    <f:loadBundle var="contractBundle" basename="ContractBundle"/>
    <f:loadBundle var="documentTypeBundle" basename="DocumentTypeBundle"/>
    <ui:define name="completeFilterFields">
        <ul>
            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="number" value="#{contractBundle['box.contract.number']}:" styleClass="filter-name"/>
					</span>
					<span class="filter-value">
						<p:inputText id="number" value="#{contractListViewState.number}"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="contract_type"  value="#{overallBundle['box.overall.type']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="contract_type" value="#{contractListViewState.contractType}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{contractListViewModel.contractTypes}" var="contractType"
										   itemLabel="#{contractType.name}" itemValue="#{contractType}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>


            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="state" value="#{overallBundle['box.overall.state']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="state" value="#{contractListViewState.state}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{contractListViewModel.states}" var="state"
										   itemLabel="#{state.name}" itemValue="#{state}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="valid_from" value="#{overallBundle['box.overall.valid_from']}:"/>
					</span>
					<span class="filter-value">
						<p:calendar id="valid_from" value="#{contractListViewState.validFrom}"
									pattern="#{dateUtils.DATE_DEFAULT_PATTERN}" styleClass="width-43-percents"
                                    locale="#{languageBean.locale.language}"/>

						<p:outputLabel for="valid_to" value="#{overallBundle['box.overall.valid_to.short']}:" styleClass="m-tex-al-right width-10-percents"/>
						<p:calendar id="valid_to" value="#{contractListViewState.validTo}" pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"
									styleClass="width-43-percents" locale="#{languageBean.locale.language}"/>
					</span>
				</div>
			</li>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="customer_type" value="#{contractBundle['box.contract.customer.type']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="customer_type" value="#{contractListViewState.customerType}">

							<p:ajax process="@this" update="#{filterFormId}-customer"/>

							<f:selectItem itemValue=""/>
							<f:selectItems value="#{contractListViewModel.customerTypes}" var="customerType"
										   itemLabel="#{customerType.name}" itemValue="#{customerType}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

			<ui:fragment rendered="#{contractListViewModel.providerRendered}">
				<li>
					<div class="filter-item">
						<span class="filter-name">
							<p:outputLabel for="provider" value="#{documentTypeBundle['box.doc.type.contract.provider']}:"/>
						</span>
						<span class="filter-value">
							<p:selectOneMenu id="provider" value="#{contractListViewState.provider}">
								<f:selectItem itemValue=""/>
								<f:selectItems value="#{contractListViewModel.providers}" var="provider"
										   	itemLabel="#{provider.name}" itemValue="#{provider}"/>
							</p:selectOneMenu>
						</span>
					</div>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewModel.brokerRendered}">
				<li>
					<div class="filter-item">
						<span class="filter-name">
							<p:outputLabel for="broker" value="#{contractBundle['box.contract.broker']}:"/>
						</span>
						<span class="filter-value">
							<p:selectOneMenu id="broker" value="#{contractListViewState.broker}">
								<f:selectItem itemValue=""/>
								<f:selectItems value="#{contractListViewModel.brokers}" var="broker"
										   	itemLabel="#{broker.name}" itemValue="#{broker}"/>
							</p:selectOneMenu>
						</span>
					</div>
				</li>
			</ui:fragment>

            <li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="customer" value="#{contractBundle['box.contract.customer']}:"/>
					</span>
					<span class="filter-value">
						<p:autoComplete id="customer" value="#{contractListViewState.customer}" var="customer"
										itemValue="#{customer}" itemLabel="#{customer.name}"
										disabled="#{contractListViewState.customerType eq null}"
										completeMethod="#{contractListViewModel.completeCustomer}"/>
					</span>
				</div>
			</li>
        </ul>
    </ui:define>

    <ui:define name="shortFilterFields">
        <ul>
            <ui:fragment rendered="#{contractListViewState.number ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.number']}:"/>
					<h:outputText value="#{contractListViewState.number};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.contractType.name ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.type']}:"/>
					<h:outputText value="#{contractListViewState.contractType.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.state.name ne null}">
				<li>
					<p:outputLabel value="#{contractBundle['box.overall.state']}:"/>
					<h:outputText value="#{contractListViewState.state.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.validTo ne null or contractListViewState.validFrom ne null}">
				<li>
					<p:outputLabel value="#{contractBundle['box.overall.valid_from']}:"/>
					<h:outputText value="#{dateUtils.format(contractListViewState.validFrom, dateUtils.DATE_DEFAULT_PATTERN, TZ.serverTimeZone)}"/>
					<p:outputLabel value="#{contractBundle['box.overall.valid_to.short']}" styleClass="m-pad-left-3" rendered="#{contractListViewState.validTo ne null}"/>
					<h:outputText value="#{dateUtils.format(contractListViewState.validTo, dateUtils.DATE_DEFAULT_PATTERN, TZ.serverTimeZone)};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.provider.name ne null}">
				<li>
					<p:outputLabel value="#{documentTypeBundle['box.doc.type.contract.provider']}:"/>
					<h:outputText value="#{contractListViewState.provider.name};"/>
				</li>
			</ui:fragment>
			

			<ui:fragment rendered="#{contractListViewState.broker.name ne null}">
				<li>
					<p:outputLabel value="#{contractBundle['box.contract.broker']}:"/>
					<h:outputText value="#{contractListViewState.broker.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.customerType.name ne null}">
				<li>
					<p:outputLabel value="#{contractBundle['box.contract.customer.type']}:"/>
					<h:outputText value="#{contractListViewState.customerType.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{contractListViewState.customer.name ne null}">
				<li>
					<p:outputLabel for="contract_short" value="#{contractBundle['box.contract.customer']}:"/>
					<h:outputText id="contract_short" value="#{contractListViewState.customer.name};"/>
				</li>
			</ui:fragment>

        </ul>
    </ui:define>

    <ui:define name="searchResult">
        <h:form id="#{resultFormId}">

            <div class="ui-dashboard-header">
                <i class="fa fa-binoculars"/>
                <h:outputText styleClass="card-header" value="#{overallBundle['box.overall.searching_results']}"/>

                <p:outputPanel styleClass="m-fright">
                    <p:commandButton id="create_contract_button" value="#{contractBundle['box.contract.create']}"
                                     process="@this" action="#{contractCreationDialogModel.onCreationDialogOpen()}"
                                     disabled="#{!p:ifGranted('CRM_ContractEdit')}">
                        <f:setPropertyActionListener value="true" target="#{contractCreationDialogModel.redirectAfterCreation}"/>
                    </p:commandButton>
                </p:outputPanel>

            </div>

            <p:dataTable id="personnel_table" value="#{contractListViewModel.lazyDm}" var="contract" tableStyle="table-layout: fixed;"
                         lazy="true" paginator="true" rows="25" emptyMessage="#{overallBundle['box.overall.empty']}"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}" rowsPerPageTemplate="25,50,100" sortMode="single"
                         sortBy="#{ContractSort.id}" sortOrder="descending" nullSortOrder="1" selectionMode="single">

                <p:column headerText="#{overallBundle['box.overall.id']}" sortBy="#{ContractSort.id}" >
                    <boxenv:linkToCard value="#{contract.getIdentifiable()}" text="#{contract.id}"/>
                </p:column>

                <p:column headerText="#{contractBundle['box.contract']}" sortBy="#{ContractSort.contractNumber}">
                    <h:outputText value="#{contract.documentNumber}"/>
                </p:column>

                <p:column headerText="#{contractBundle['box.contract.type']}" sortBy="#{ContractSort.documentType}">
                    <h:outputText value="#{contract.documentType}"/>
                </p:column>

                <p:column headerText="#{contractBundle['box.contract.customer']}" sortBy="#{ContractSort.customer}">
                    <h:outputText value="#{contract.customer}"/>
                </p:column>

                <p:column headerText="#{contractBundle['box.contract.customer.type']}" sortBy="#{ContractSort.customerType}">
                    <h:outputText value="#{contract.customerType}"/>
                </p:column>

                <p:column headerText="#{overallBundle['box.overall.valid_from']}" sortBy="#{ContractSort.validFrom}">
                    <h:outputText value="#{contract.validFrom}">
                        <sysinf:convertDateTime pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="#{overallBundle['box.overall.valid_to']}" sortBy="#{ContractSort.validTo}">
                    <h:outputText value="#{contract.validTo}">
                        <sysinf:convertDateTime pattern="#{dateUtils.DATE_DEFAULT_PATTERN}"/>
                    </h:outputText>
                </p:column>

				<p:column headerText="#{documentTypeBundle['box.doc.type.contract.provider']}"
 						rendered="#{contractListViewModel.providerRendered}">
                    <h:outputText value="#{contract.providerName}"/>
                </p:column>

                <p:column headerText="#{contractBundle['box.contract.broker']}" sortBy="#{ContractSort.broker}"
                		rendered="#{contractListViewModel.brokerRendered}">
                    <h:outputText value="#{contract.brokerName}"/>
                </p:column>

                <p:column headerText="#{overallBundle['box.overall.state']}" sortBy="#{ContractSort.state}">
                    <h:outputText value="#{contract.state}"/>
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>

</ui:composition>