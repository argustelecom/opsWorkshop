<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
				xmlns:o="http://omnifaces.org/ui" xmlns:sysinf="http://argustelecom.ru/system-inf"
				xmlns:pm="http://primefaces.org/modena" xmlns:f="http://java.sun.com/jsf/core">

	<f:loadBundle var="contractBundle" basename="ContractBundle"/>
	<p:outputPanel rendered="#{p:ifGranted('CRM_ContractView')}">
		<div class="#{containerClass eq null ? 'm-container100' : containerClass} m-responsive100">
			<div class="m-container-indent">
				<div class="m-card m-shadow-effect custom-content-card simple-fb">
					<h:form id="order_contracts_form">

						<f:event listener="#{orderContractsFrameModel.preRender(order)}" type="preRenderComponent"/>

						<o:importConstants type="ru.argustelecom.box.env.order.lifecycle.OrderLifecycle.Behaviors" var="behavior"/>

						<div class="ui-dashboard-header">
							<i class="fa fa-list-alt"/>
							<h:outputText styleClass="card-header"
										  value="#{contractBundle['box.contract.plural']}"/>

							<p:outputPanel styleClass="m-fright">
								<p:commandLink styleClass="m-mar-left10" process="@this"
											   title="#{overallBundle['box.overall.add']}"
											 	action="#{contractCreationDialogModel.onCreationDialogOpen()}"
											 	rendered="#{!behaviorUtils.isForbidden(orderCardViewModel.order, behavior.createContract)}"
											 	disabled="#{!p:ifGranted('CRM_ContractEdit')}">
												<i class="fa fa-edit icon-btn"/>
												<f:setPropertyActionListener value="#{orderContractsFrameModel.order.customer}"
																			target="#{contractCreationDialogModel.newCustomer}"/>
												<f:setPropertyActionListener value="true" target="#{contractCreationDialogModel.selectTypeByCustomerType}"/>
												<f:setPropertyActionListener value="#{orderContractsFrameModel.order}"
																			target="#{contractCreationDialogModel.order}"/>
									<f:setPropertyActionListener value="#{orderContractsFrameModel.order.connectionAddress}"
																 target="#{contractCreationDialogModel.currentLocation}"/>
								</p:commandLink>

								<p:commandLink styleClass="m-mar-left10" process="@this"
											   title="#{overallBundle['box.overall.add']}"
											 	action="#{contractExtensionCreationDialogModel.onCreationDialogOpen()}"
											 	rendered="#{not empty orderContractsFrameModel.contractsWhichMayHaveExtensions
											 			 	and !behaviorUtils.isForbidden(orderCardViewModel.order, behavior.createContractExtension)}"
											 	disabled="#{!p:ifGranted('CRM_ContractEdit')}">
												<i class="fa fa-chain (alias) icon-btn"/>
												<f:setPropertyActionListener value="#{orderContractsFrameModel.order}"
																			target="#{contractExtensionCreationDialogModel.order}"/>
												<f:setPropertyActionListener value="true" target="#{contractExtensionCreationDialogModel.selectTypeByCustomerType}"/>
												<f:setPropertyActionListener value="#{orderContractsFrameModel.order.customer}"
																			 target="#{contractExtensionCreationDialogModel.newCustomer}"/>
												<f:setPropertyActionListener value="#{orderContractsFrameModel.contractsWhichMayHaveExtensions}"
																			target="#{contractExtensionCreationDialogModel.possibleContracts}"/>
								</p:commandLink>
							</p:outputPanel>
						</div>

						<ui:include src="/views/env/contract/ContractsBodyFrame.xhtml">
							<ui:param name="contracts" value="#{contracts}"/>
						</ui:include>

					</h:form>
				</div>
			</div>
		</div>
	</p:outputPanel>

	<ui:include src="/views/env/page/frame/NotGrantedFrame.xhtml">
		<ui:param name="headerIcon" value="fa fa-list-alt" />
		<ui:param name="headerText" value="#{contractBundle['box.contract.plural']}" />
		<ui:param name="permission" value="#{permissionRepository.getPermission('CRM_ContractView')}" />
	</ui:include>

</ui:composition>