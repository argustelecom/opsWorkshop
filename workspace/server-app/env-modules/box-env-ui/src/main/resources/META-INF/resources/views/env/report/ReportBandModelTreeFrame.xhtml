<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui">

	<f:loadBundle var="reportBundle" basename="ReportBundle"/>
	<h:form id="report_band_tree_form">

		<f:event type="preRenderComponent" listener="#{reportBandsFm.preRender(reportType)}" />

		<script>
			$( document ).ready(function() {
				Argus.System.AutoHeight.compute('report_type_tab_view-report_band_tree_form', 40);
			});
		</script>

		<div id="report_band_model" class="m-mar-right10 report-band">
			<h3 class="h3-header bottom-border">
				<h:outputText value="#{reportBundle['box.report.band.plural']}" styleClass="m-disp-inl-block m-pad-bot5"/>
				<p:outputPanel id="report_band_model_managed_btns" styleClass="m-tex-al-right m-fright">
					<p:commandLink id="create_button" styleClass="m-mar-left10" process="@this" title="#{reportBundle['box.report.band.create']}"
								   action="#{reportBandCreationDm.openCreationDlg()}" disabled="#{not reportBandsFm.hasSelectedNode() or readonly}">
						<i class="icon-playlist_add icon-btn fs20"/>
						<f:setPropertyActionListener value="#{reportType}" target="#{reportBandCreationDm.reportType}"/>
						<f:setPropertyActionListener value="#{reportBandsFm.callback}" target="#{reportBandCreationDm.callback}"/>
						<f:setPropertyActionListener value="#{reportBandsFm.selectedBand}" target="#{reportBandCreationDm.parent}"/>
					</p:commandLink>

					<p:commandLink id="report_band_model_remove_btn" styleClass="m-mar-left10" title="#{reportBundle['box.report.band.delete']}"
								   process="@this" action="#{reportBandsFm.removeSelectedNode()}"
								   disabled="#{not reportBandsFm.hasSelectedNode() or readonly}"
								   update="@this report_type_tab_view-report_band_tree_form-report_band_tree report_type_tab_view-query_metadata_form">
						<i class="fa fa-trash icon-btn fs20"/>
						<p:confirm header="#{reportBundle['box.report.band.delete_dialog']}"
                                   message="#{reportBundle['box.report.band.delete_dialog.details']} #{reportBandsFm.strategy.selectedNode.data.keyword}?"/>
					</p:commandLink>
				</p:outputPanel>
			</h3>

            <p:outputPanel id="band_tree_panel">
				<p:tree id="report_band_tree" styleClass="tree-no-border width-100-percents"
						value="#{reportBandsFm.treeNode}" var="node" lazy="true" dynamic="true" selectionMode="single"
						selection="#{reportBandsFm.strategy.selectedNode}" draggable="#{not readonly}" droppable="#{not readonly}"
						highlight="true" cashe="false" propagateSelectionUp="false" propagateSelectionDown="false">

                    <p:ajax event="select"
                            update="report_attributes_form report_type_tab_view-query_metadata_form report_type_tab_view-report_band_tree_form-report_band_model_managed_btns"/>
                    <p:ajax event="expand" listener="#{reportBandsFm.onNodeExpand}"/>
                    <p:ajax event="collapse" listener="#{reportBandsFm.onNodeCollapse}"/>
					<p:ajax event="dragdrop" listener="#{reportBandsFm.onDragDrop}" update="report_type_tab_view-report_band_tree_form-report_band_tree"/>

                    <p:treeNode type="band">
                        <h:outputText value=" #{node.keyword}"/>
                    </p:treeNode>

                </p:tree>
            </p:outputPanel>
		</div>
	</h:form>
</ui:composition>