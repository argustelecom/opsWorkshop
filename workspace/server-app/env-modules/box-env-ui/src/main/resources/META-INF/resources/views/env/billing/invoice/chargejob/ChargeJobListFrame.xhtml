<ui:composition template="/views/env/filter/ListFrame.xhtml" xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
				xmlns:boxenv="http://argustelecom.ru/box/env">

	<f:loadBundle var="chargeJobBundle" basename="ChargeJobBundle"/>

	<ui:define name="completeFilterFields">
		<o:importConstants type="ru.argustelecom.box.env.billing.invoice.model.JobDataType" var="jobDataType"/>
		<o:importConstants type="ru.argustelecom.box.env.billing.invoice.model.ChargeJobState" var="chargeJobState"/>
		<ul>
			<li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="data_type"  value="#{chargeJobBundle['box.charge_job.type']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="data_type" value="#{chargeJobListVs.dataType}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{jobDataType.values()}" var="type"
										   itemLabel="#{type.nameToShow()}" itemValue="#{type}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

			<li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="mediation_id" value="#{chargeJobBundle['box.charge_job.number']}:"/>
					</span>
					<span class="filter-value">
						<p:inputText id="mediation_id" value="#{chargeJobListVs.mediationId}"/>
					</span>
				</div>
			</li>

			<li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="select_state"  value="#{overallBundle['box.overall.state']}:"/>
					</span>
					<span class="filter-value">
						<p:selectOneMenu id="select_state" value="#{chargeJobListVs.state}">
							<f:selectItem itemValue=""/>
							<f:selectItems value="#{chargeJobState.values()}" var="state"
										   itemLabel="#{state.getName()}" itemValue="#{state}"/>
						</p:selectOneMenu>
					</span>
				</div>
			</li>

			<li>
				<div class="filter-item">
					<span class="filter-name">
						<p:outputLabel for="valid_from" value="#{overallBundle['box.overall.valid_from']}:"/>
					</span>
					<span class="filter-value">
						<p:calendar id="valid_from" value="#{chargeJobListVs.validFrom}"
									pattern="#{dateUtils.DATETIME_WITH_SECONDS_PATTERN}" styleClass="width-43-percents"
									locale="#{languageBean.locale.language}"/>

						<p:outputLabel for="valid_to" value="#{overallBundle['box.overall.valid_to.short']}:" styleClass="m-tex-al-right width-10-percents"/>
						<p:calendar id="valid_to" value="#{chargeJobListVs.validTo}" pattern="#{dateUtils.DATETIME_WITH_SECONDS_PATTERN}"
									styleClass="width-43-percents" locale="#{languageBean.locale.language}"/>
					</span>
				</div>
			</li>
		</ul>
	</ui:define>

	<ui:define name="shortFilterFields">
		<ul>
			<ui:fragment rendered="#{chargeJobListVs.dataType ne null}">
				<li>
					<p:outputLabel value="#{chargeJobBundle['box.charge_job.type']}:"/>
					<h:outputText value="#{chargeJobListVs.dataType.nameToShow()};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{chargeJobListVs.mediationId ne null}">
				<li>
					<p:outputLabel value="#{chargeJobBundle['box.charge_job.number']}:"/>
					<h:outputText value="#{chargeJobListVs.mediationId};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{chargeJobListVs.state.name ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.state']}:"/>
					<h:outputText value="#{chargeJobListVs.state.name};"/>
				</li>
			</ui:fragment>

			<ui:fragment rendered="#{chargeJobListVs.validTo ne null or chargeJobListVs.validFrom ne null}">
				<li>
					<p:outputLabel value="#{overallBundle['box.overall.valid_from']}:"/>
					<h:outputText value="#{dateUtils.format(chargeJobListVs.validFrom, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)}"/>
					<p:outputLabel value="#{overallBundle['box.overall.valid_to.short']}" styleClass="m-pad-left-3" rendered="#{chargeJobListVs.validTo ne null}"/>
					<h:outputText value="#{dateUtils.format(chargeJobListVs.validTo, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)};"/>
				</li>
			</ui:fragment>
		</ul>
	</ui:define>

	<ui:define name="searchResult">

		<h:form id="#{resultFormId}">
			<f:loadBundle var="chargeJobBundle" basename="ChargeJobBundle"/>

			<div class="ui-dashboard-header">
				<i class="fa fa-binoculars"/>
				<h:outputText styleClass="card-header" value="#{overallBundle['box.overall.searching_results']}"/>
				<p:outputPanel styleClass="m-fright">
					<p:commandButton id="recharge_button"
									 value="#{chargeJobBundle['box.charge_job.creation_button']}"
									 disabled="#{!p:ifGranted('Billing_ChargeJobCreate')}"
									 action="#{chargeJobCreationDm.onDialogOpen()}"/>
				</p:outputPanel>
			</div>

			<p:dataTable id="charge_job_table" value="#{chargeJobListVm.lazyDm}" var="job" lazy="true"
						 paginator="true" rows="25" emptyMessage="#{overallBundle['box.overall.empty']}"
						 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						 currentPageReportTemplate="{startRecord} - {endRecord} #{overallBundle['box.overall.from']} {totalRecords}"
						 rowsPerPageTemplate="25,50,100" sortMode="single"
						 sortBy="#{ChargeJobSort.id}" sortOrder="descending" selectionMode="single">

				<p:column headerText="#{chargeJobBundle['box.charge_job.number']}"
						  sortBy="#{ChargeJobSort.id}">
					<boxenv:linkToCard value="#{job.getIdentifiable()}" text="#{job.mediationId}"/>
				</p:column>

				<p:column headerText="#{chargeJobBundle['box.charge_job.type']}"
						  sortBy="#{ChargeJobSort.dataType}">
					<h:outputText value="#{job.dataType.nameToShow()}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.state']}"
						  sortBy="#{ChargeJobSort.state}">
					<h:outputText value="#{job.state.getName()}"/>
				</p:column>

				<p:column headerText="#{overallBundle['box.overall.creation_date']}"
						  sortBy="#{ChargeJobSort.creationDate}">
					<h:outputText value="#{dateUtils.format(job.creationDate, dateUtils.DATETIME_WITH_SECONDS_PATTERN, TZ.serverTimeZone)}"/>
				</p:column>

			</p:dataTable>

		</h:form>
	</ui:define>
</ui:composition>