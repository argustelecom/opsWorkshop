<ui:composition template="/views/inf/page/View.xhtml" xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
				xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:p="http://primefaces.org/ui"
				xmlns:pe="http://primefaces.org/ui/extensions" xmlns:o="http://omnifaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:sysinf="http://argustelecom.ru/system-inf">

	<ui:param name="viewModel" value="#{measureUnitDirectoryViewModel}"/>
	<ui:param name="pageTitle" value="#{measureBundle['box.measure.unit.plural']}"/>

	<ui:define name="head">
		<h:outputStylesheet name="box-env/styles/box-env.css"/>
		<h:outputStylesheet name="inf/styles/box-functional-block.css"/>
	</ui:define>

	<ui:define name="pagePath">

		<f:loadBundle basename="MeasureBundle" var="measureBundle"/>
		<f:loadBundle basename="OverallBundle" var="overallBundle"/>

		<p:menuitem value="#{overallBundle['box.overall.home']}" url="/views/env/home/HomeView.xhtml"/>
		<p:menuitem value="#{overallBundle['box.overall.dir.dashboard']}" url="/views/env/directory/DirectoryDashboardView.xhtml" />
		<p:menuitem value="#{measureBundle['box.measure.unit.plural']}" />
	</ui:define>

	<ui:define name="body">

		<div class="m-container35 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<div id="measure_tree">
							<h:form id="tree_buttons_form">
								<div class="ui-dashboard-header">
									<i class="fa fa-folder-open"/>
									<h:outputText value="#{measureBundle['box.measure.unit.plural']}" styleClass="card-header"/>

									<p:outputPanel id="measure_managed_buttons" styleClass="m-fright">
										<p:commandLink id="create_measure" styleClass="m-mar-left10" title="#{overallBundle['box.overall.create']}"
														oncomplete="PF('createMeasureDlgVar').show()" update="-measure_unit_creation_form-create_measure_dlg"
														process="@this" disabled="#{!p:ifGranted('System_MeasureUnitEdit')}">
														<i class="fa fa-edit icon-btn"/>
														<f:setPropertyActionListener value="#{measureUnitDirectoryViewModel.selectedNode}" target="#{measureUnitCreationDM.selectedNode}"/>
														<f:setPropertyActionListener value="#{measureUnitDirectoryViewModel.callback}" target="#{measureUnitCreationDM.callback}"/>
										</p:commandLink>

										<p:commandLink id="delete_measure" styleClass="m-mar-left10" title="#{overallBundle['box.overall.delete']}"
														 disabled="#{!p:ifGranted('System_MeasureUnitEdit') or measureUnitDirectoryViewModel.measureDeletable}"
														 update="-measure_filter -tree_buttons_form -measure_list_form" process="@this"
														 action="#{measureUnitDirectoryViewModel.deleteMeasure()}">
														<i class="fa fa-trash icon-btn"/>
														<p:confirm header="#{measureBundle['box.measure.unit.delete_dialog']}"
																   message="#{measureBundle['box.measure.unit.delete_dialog.details']} #{sysinf:castEntity(measureUnitDirectoryViewModel.selectedNode.data, 'MeasureUnit').name}&apos;?"/>
										</p:commandLink>
									</p:outputPanel>
								</div>

							</h:form>
								<p:tabView id="measure_filter">
									<p:ajax event="tabChange" listener="#{measureUnitDirectoryViewModel.onTabChange}" update="-measure_list_form -tree_buttons_form" />
									<p:tab title="#{measureBundle['box.measure.unit.active']}">
										<p:tree id="tree_model" value="#{measureUnitDirectoryViewModel.treeModelRoot}" var="measure"
												dynamic="true" cache="false" selectionMode="single" draggable="false" droppable="false"
												selection="#{measureUnitDirectoryViewModel.selectedNode}" styleClass="width-100-percents m-ov-auto tree-no-border">
											<p:ajax event="select" immediate="true" update="-measure_list_form -tree_buttons_form" />
											<p:ajax event="collapse" immediate="true" />
											<p:ajax event="expand" immediate="true" />

											<p:treeNode type="Group">
												<i class="fa fa-folder-open m-fleft m-mar-right3 m-mar-top3" />
												<h:outputText value="#{measure.groupName}"  title="#{measure.groupName}" />
											</p:treeNode>

											<p:treeNode type="MeasureUnit">
												<!--<p:graphicImage styleClass="measure-basic-icon" name="rms/images/star.png"
																	title="#{measureUnitBundle['box.measure.unit.basic']}"
																	rendered="#{sysinf:isEntity(measure, 'BaseMeasureUnit')}" />-->
												<i class="icon-straighten m-fleft m-mar-right3 m-mar-top3" />
												<h:outputText value=" #{measure.name}" title=" #{measure.name}" />
												<!--<p:graphicImage styleClass="measure-system-icon" name="system/images/common/personnel/system.png"
																title="#{measureUnitBundle['box.measure.unit.system']}" rendered="#{measure.isSys}"/>-->
											</p:treeNode>
										</p:tree>
										<script>
											$( document ).ready(function() {
												Argus.System.AutoHeight.compute('measure_tree', 40);
												Argus.System.AutoHeight.compute('measure_filter-tree_model', 280);
											});
										</script>
									</p:tab>

									<p:tab title="#{overallBundle['box.overall.empty']}"  titleStyleClass="argus-ui-icon-warning" rendered="false">
										<p:tree id="tree_model_i" value="#{measureUnitDirectoryViewModel.treeModelInvalid}" var="measure"
												dynamic="true" cache="false" selectionMode="single" draggable="false" droppable="false"
												selection="#{measureUnitDirectoryViewModel.selectedNode}">
											<p:ajax event="select" immediate="true" update="-measure_list_form -tree_buttons_form" />

											<p:treeNode type="MeasureUnit">
												<h:outputText value="#{measure.name}" title="#{measureUnitDirectoryViewModel.getMessage(measure)}" />
												<p:graphicImage styleClass="measure-system-icon" name="system/images/common/personnel/system.png"
																title="#{measureBundle['box.measure.unit.system']}" rendered="#{measure.isSys}"/>
											</p:treeNode>
										</p:tree>
									</p:tab>
								</p:tabView>

						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="m-container65 m-responsive100">
			<div class="m-container100">
				<div class="m-container-indent">
					<div class="m-card m-shadow-effect simple-fb">
						<h:form id="measure_list_form">
							<script>
								$( document ).ready(function() {
									Argus.System.AutoHeight.compute('measure_list_form', 35);
								});
							</script>

							<h:panelGroup rendered="#{measureUnitDirectoryViewModel.measureSelected}">
								<div class="ui-dashboard-header">
									<i class="icon-straighten"/>
									<h:outputText styleClass="card-header" value="#{measureUnitDirectoryViewModel.selectedNode.data.name}" />
								</div>

								<sysinf:editableSection disabled="#{!p:ifGranted('System_MeasureUnitEdit') or measureUnitDirectoryViewModel.editAttributesDisabled}"
														saveLabel="#{overallBundle['box.overall.save']}"
														cancelLabel="#{overallBundle['box.overall.cancel']}">
									<dl class="name-value width-250 m-font-roboto-regular">
										<dt>
											<h:outputText value="#{measureBundle['box.measure.unit.code']}:" />
										</dt>
										<dd>
											<h:outputText value="#{measureUnitDirectoryViewModel.selectedNode.data.code}" styleClass="m-mar-left-8"/>
										</dd>

										<dt>
											<p:outputLabel for="measure_group" value="#{measureBundle['box.measure.unit.group']}:" />
											<h:outputText class="ui-growl-image ui-small-image ui-growl-small-image-warning"
														  rendered="#{measureUnitDirectoryViewModel.selectedNode.data.group eq null}" />
										</dt>
										<dd>
											<p:selectOneMenu id="measure_group" required="true" value="#{measureUnitDirectoryViewModel.selectedNode.data.group}">
												<p:ajax listener="#{measureUnitDirectoryViewModel.changeMeasureGroupTreeModel()}" update="-measure_filter" />
												<f:selectItems value="#{measureUnitDirectoryViewModel.groups}" var="measure"
															   itemLabel="#{measure.groupName}" itemValue="#{measure}"/>
											</p:selectOneMenu>
										</dd>

										<dt>
											<h:outputText value="#{measureBundle['box.measure.unit.symbol']}: " />
										</dt>
										<dd>
											<h:outputText value="#{measureUnitDirectoryViewModel.selectedNode.data.symbol}" styleClass="m-mar-left-8"/>
										</dd>

										<dt>
											<p:outputLabel for="measure_factor"
														   value="#{measureBundle['box.measure.unit.conversion.coefficient']}:" />
											<h:outputText class="ui-growl-image ui-small-image ui-growl-small-image-warning"
														  rendered="#{measureUnitDirectoryViewModel.selectedMeasureFactor eq null}" />
										</dt>
										<dd>
											<p:inputText id="measure_factor" required="true"
														 value="#{measureUnitDirectoryViewModel.selectedMeasureFactor}"
														 label="#{measureBundle['box.measure.unit.conversion.coefficient']}">
												<p:ajax update="-measure_filter" />
												<f:validateLongRange minimum="1" />
											</p:inputText>
										</dd>

										<dt>
											<h:outputText value="#{measureBundle['box.measure.unit.basic']}"
														  rendered="#{measureUnitDirectoryViewModel.selectedMeasureBasic}" />
										</dt>
										<dd>

										</dd>
									</dl>
								</sysinf:editableSection>
							</h:panelGroup>
						</h:form>
					</div>
				</div>
			</div>
		</div>
	</ui:define>

	<ui:define name="dialogs">
		<ui:include src="MeasureUnitCreationDialog.xhtml"/>
	</ui:define>

</ui:composition>